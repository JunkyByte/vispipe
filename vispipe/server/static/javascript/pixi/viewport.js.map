{"version":3,"file":"viewport.js","sources":["../src/input-manager.js","../src/plugin-manager.js","../src/plugins/plugin.js","../src/plugins/drag.js","../src/plugins/pinch.js","../src/plugins/clamp.js","../src/plugins/clamp-zoom.js","../src/plugins/decelerate.js","../node_modules/penner/penner.js","../src/ease.js","../src/plugins/bounce.js","../src/plugins/snap.js","../src/plugins/snap-zoom.js","../src/plugins/follow.js","../src/plugins/wheel.js","../src/plugins/mouse-edges.js","../src/viewport.js"],"sourcesContent":["import * as PIXI from 'pixi.js'\r\n\r\n/**\r\n * @typedef ViewportTouch\r\n * @property {number} id\r\n * @property {PIXI.Point} last\r\n*/\r\n\r\n/**\r\n * handles all input for Viewport\r\n * @private\r\n */\r\nexport class InputManager\r\n{\r\n    constructor(viewport)\r\n    {\r\n        this.viewport = viewport\r\n\r\n        /**\r\n         * list of active touches on viewport\r\n         * @type {ViewportTouch[]}\r\n         */\r\n        this.touches = []\r\n        this.addListeners()\r\n    }\r\n\r\n    /**\r\n     * add input listeners\r\n     * @private\r\n     */\r\n    addListeners()\r\n    {\r\n        this.viewport.interactive = true\r\n        if (!this.viewport.forceHitArea)\r\n        {\r\n            this.viewport.hitArea = new PIXI.Rectangle(0, 0, this.viewport.worldWidth, this.viewport.worldHeight)\r\n        }\r\n        this.viewport.on('pointerdown', this.down, this)\r\n        this.viewport.on('pointermove', this.move, this)\r\n        this.viewport.on('pointerup', this.up, this)\r\n        this.viewport.on('pointerupoutside', this.up, this)\r\n        this.viewport.on('pointercancel', this.up, this)\r\n        this.viewport.on('pointerout', this.up, this)\r\n        this.wheelFunction = (e) => this.handleWheel(e)\r\n        this.viewport.options.divWheel.addEventListener('wheel', this.wheelFunction, { passive: this.viewport.options.passiveWheel })\r\n        this.isMouseDown = false\r\n    }\r\n\r\n    /**\r\n     * removes all event listeners from viewport\r\n     * (useful for cleanup of wheel when removing viewport)\r\n     */\r\n    destroy()\r\n    {\r\n        this.viewport.options.divWheel.removeEventListener('wheel', this.wheelFunction)\r\n    }\r\n\r\n    /**\r\n     * handle down events for viewport\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     */\r\n    down(event)\r\n    {\r\n        if (this.viewport.pause || !this.viewport.worldVisible)\r\n        {\r\n            return\r\n        }\r\n        if (event.data.pointerType === 'mouse')\r\n        {\r\n            this.isMouseDown = true\r\n        }\r\n        else if (!this.get(event.data.pointerId))\r\n        {\r\n            this.touches.push({ id: event.data.pointerId, last: null })\r\n        }\r\n        if (this.count() === 1)\r\n        {\r\n            this.last = event.data.global.clone()\r\n\r\n            // clicked event does not fire if viewport is decelerating or bouncing\r\n            const decelerate = this.viewport.plugins.get('decelerate')\r\n            const bounce = this.viewport.plugins.get('bounce')\r\n            if ((!decelerate || !decelerate.isActive()) && (!bounce || !bounce.isActive()))\r\n            {\r\n                this.clickedAvailable = true\r\n            }\r\n            else\r\n            {\r\n                this.clickedAvailable = false\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.clickedAvailable = false\r\n        }\r\n\r\n        const stop = this.viewport.plugins.down(event)\r\n        if (stop && this.viewport.options.stopPropagation)\r\n        {\r\n            event.stopPropagation()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {number} change\r\n     * @returns whether change exceeds threshold\r\n     */\r\n    checkThreshold(change)\r\n    {\r\n        if (Math.abs(change) >= this.viewport.threshold)\r\n        {\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * handle move events for viewport\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     */\r\n    move(event)\r\n    {\r\n        if (this.viewport.pause || !this.viewport.worldVisible)\r\n        {\r\n            return\r\n        }\r\n\r\n        const stop = this.viewport.plugins.move(event)\r\n\r\n        if (this.clickedAvailable)\r\n        {\r\n            const distX = event.data.global.x - this.last.x\r\n            const distY = event.data.global.y - this.last.y\r\n            if (this.checkThreshold(distX) || this.checkThreshold(distY))\r\n            {\r\n                this.clickedAvailable = false\r\n            }\r\n        }\r\n\r\n        if (stop && this.viewport.options.stopPropagation)\r\n        {\r\n            event.stopPropagation()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * handle up events for viewport\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     */\r\n    up(event)\r\n    {\r\n        if (this.viewport.pause || !this.viewport.worldVisible)\r\n        {\r\n            return\r\n        }\r\n\r\n        if (event.data.pointerType === 'mouse')\r\n        {\r\n            this.isMouseDown = false\r\n        }\r\n\r\n        if (event.data.pointerType !== 'mouse')\r\n        {\r\n            this.remove(event.data.pointerId)\r\n        }\r\n\r\n        const stop = this.viewport.plugins.up(event)\r\n\r\n        if (this.clickedAvailable && this.count() === 0)\r\n        {\r\n            this.viewport.emit('clicked', { event: event, screen: this.last, world: this.viewport.toWorld(this.last), viewport: this })\r\n            this.clickedAvailable = false\r\n        }\r\n\r\n        if (stop && this.viewport.options.stopPropagation)\r\n        {\r\n            event.stopPropagation()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * gets pointer position if this.interaction is set\r\n     * @param {WheelEvent} event\r\n     * @return {PIXI.Point}\r\n     */\r\n    getPointerPosition(event)\r\n    {\r\n        let point = new PIXI.Point()\r\n        if (this.viewport.options.interaction)\r\n        {\r\n            this.viewport.options.interaction.mapPositionToPoint(point, event.clientX, event.clientY)\r\n        }\r\n        else\r\n        {\r\n            point.x = event.clientX\r\n            point.y = event.clientY\r\n        }\r\n        return point\r\n    }\r\n\r\n    /**\r\n     * handle wheel events\r\n     * @param {WheelEvent} event\r\n     */\r\n    handleWheel(event)\r\n    {\r\n        if (this.viewport.pause || !this.viewport.worldVisible)\r\n        {\r\n            return\r\n        }\r\n\r\n        // only handle wheel events where the mouse is over the viewport\r\n        const point = this.viewport.toLocal(this.getPointerPosition(event))\r\n        if (this.viewport.left <= point.x && point.x <= this.viewport.right && this.viewport.top <= point.y && point.y <= this.viewport.bottom)\r\n        {\r\n            const stop = this.viewport.plugins.wheel(event)\r\n            if (stop && !this.viewport.options.passiveWheel)\r\n            {\r\n                event.preventDefault()\r\n            }\r\n        }\r\n    }\r\n\r\n    pause()\r\n    {\r\n        this.touches = []\r\n        this.isMouseDown = false\r\n    }\r\n\r\n    /**\r\n     * get touch by id\r\n     * @param {number} id\r\n     * @return {ViewportTouch}\r\n     */\r\n    get(id)\r\n    {\r\n        for (let touch of this.touches)\r\n        {\r\n            if (touch.id === id)\r\n            {\r\n                return touch\r\n            }\r\n        }\r\n        return null\r\n    }\r\n\r\n    /**\r\n     * remove touch by number\r\n     * @param {number} id\r\n     */\r\n    remove(id)\r\n    {\r\n        for (let i = 0; i < this.touches.length; i++)\r\n        {\r\n            if (this.touches[i].id === id)\r\n            {\r\n                this.touches.splice(i, 1)\r\n                return\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns {number} count of mouse/touch pointers that are down on the viewport\r\n     */\r\n    count()\r\n    {\r\n        return (this.isMouseDown ? 1 : 0) + this.touches.length\r\n    }\r\n}","const PLUGIN_ORDER = ['drag', 'pinch', 'wheel', 'follow', 'mouse-edges', 'decelerate', 'bounce', 'snap-zoom', 'clamp-zoom', 'snap', 'clamp']\r\n\r\n/**\r\n * Use this to access current plugins or add user-defined plugins\r\n */\r\nexport class PluginManager\r\n{\r\n    /**\r\n     * instantiated by Viewport\r\n     * @param {Viewport} viewport\r\n     */\r\n    constructor(viewport)\r\n    {\r\n        this.viewport = viewport\r\n        this.list = []\r\n        this.plugins = {}\r\n    }\r\n\r\n    /**\r\n     * Inserts a named plugin or a user plugin into the viewport\r\n     * default plugin order: 'drag', 'pinch', 'wheel', 'follow', 'mouse-edges', 'decelerate', 'bounce', 'snap-zoom', 'clamp-zoom', 'snap', 'clamp'\r\n     * @param {string} name of plugin\r\n     * @param {Plugin} plugin - instantiated Plugin class\r\n     * @param {number} index to insert userPlugin (otherwise inserts it at the end)\r\n     */\r\n    add(name, plugin, index = PLUGIN_ORDER.length)\r\n    {\r\n        this.plugins[name] = plugin\r\n        const current = PLUGIN_ORDER.indexOf(name)\r\n        if (current !== -1)\r\n        {\r\n            PLUGIN_ORDER.splice(current, 1)\r\n        }\r\n        PLUGIN_ORDER.splice(index, 0, name)\r\n        this.sort()\r\n    }\r\n\r\n    /**\r\n     * get plugin\r\n     * @param {string} name of plugin\r\n     * @return {Plugin}\r\n     */\r\n    get(name)\r\n    {\r\n        return this.plugins[name]\r\n    }\r\n\r\n    /**\r\n     * update all active plugins\r\n     * @private\r\n     * @param {number} elapsed type in milliseconds since last update\r\n     */\r\n    update(elapsed)\r\n    {\r\n        for (let plugin of this.list)\r\n        {\r\n            plugin.update(elapsed)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * resize all active plugins\r\n     * @private\r\n     */\r\n    resize()\r\n    {\r\n        for (let plugin of this.list)\r\n        {\r\n            plugin.resize()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * clamps and resets bounce and decelerate (as needed) after manually moving viewport\r\n     */\r\n    reset()\r\n    {\r\n        for (let plugin of this.list)\r\n        {\r\n            plugin.reset()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * removes installed plugin\r\n     * @param {string} name of plugin (e.g., 'drag', 'pinch')\r\n     */\r\n    remove(name)\r\n    {\r\n        if (this.plugins[name])\r\n        {\r\n            this.plugins[name] = null\r\n            this.viewport.emit(name + '-remove')\r\n            this.sort()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * pause plugin\r\n     * @param {string} name of plugin (e.g., 'drag', 'pinch')\r\n     */\r\n    pause(name)\r\n    {\r\n        if (this.plugins[name])\r\n        {\r\n            this.plugins[name].pause()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * resume plugin\r\n     * @param {string} name of plugin (e.g., 'drag', 'pinch')\r\n     */\r\n    resume(name)\r\n    {\r\n        if (this.plugins[name])\r\n        {\r\n            this.plugins[name].resume()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * sort plugins according to PLUGIN_ORDER\r\n     * @private\r\n     */\r\n    sort()\r\n    {\r\n        this.list = []\r\n        for (let plugin of PLUGIN_ORDER)\r\n        {\r\n            if (this.plugins[plugin])\r\n            {\r\n                this.list.push(this.plugins[plugin])\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * handle down for all plugins\r\n     * @private\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    down(event)\r\n    {\r\n        let stop = false\r\n        for (let plugin of this.list)\r\n        {\r\n            if (plugin.down(event))\r\n            {\r\n                stop = true\r\n            }\r\n        }\r\n        return stop\r\n    }\r\n\r\n    /**\r\n     * handle move for all plugins\r\n     * @private\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    move(event)\r\n    {\r\n        let stop = false\r\n        for (let plugin of this.viewport.plugins.list)\r\n        {\r\n            if (plugin.move(event))\r\n            {\r\n                stop = true\r\n            }\r\n        }\r\n        return stop\r\n    }\r\n\r\n    /**\r\n     * handle up for all plugins\r\n     * @private\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    up(event)\r\n    {\r\n        let stop = false\r\n        for (let plugin of this.list)\r\n        {\r\n            if (plugin.up(event))\r\n            {\r\n                stop = true\r\n            }\r\n        }\r\n        return stop\r\n    }\r\n\r\n    /**\r\n     * handle wheel event for all plugins\r\n     * @private\r\n     * @param {WheelEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    wheel(e)\r\n    {\r\n        let result = false\r\n        for (let plugin of this.list)\r\n        {\r\n            if (plugin.wheel(e))\r\n            {\r\n                result = true\r\n            }\r\n        }\r\n        return result\r\n    }\r\n}","/**\r\n * derive this class to create user-defined plugins\r\n */\r\nexport class Plugin\r\n{\r\n    /**\r\n     * @param {Viewport} parent\r\n     */\r\n    constructor(parent)\r\n    {\r\n        this.parent = parent\r\n        this.paused = false\r\n    }\r\n\r\n    /** called when plugin is removed */\r\n    destroy() {}\r\n\r\n    /**\r\n     * handler for pointerdown PIXI event\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    down()\r\n    {\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * handler for pointermove PIXI event\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    move()\r\n    {\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * handler for pointerup PIXI event\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    up()\r\n    {\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * handler for wheel event on div\r\n     * @param {WheelEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    wheel()\r\n    {\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * called on each tick\r\n     * @param {number} elapsed time in millisecond since last update\r\n     */\r\n    update() { }\r\n\r\n    /** called when the viewport is resized */\r\n    resize() { }\r\n\r\n    /** called when the viewport is manually moved */\r\n    reset() { }\r\n\r\n    /** pause the plugin */\r\n    pause()\r\n    {\r\n        this.paused = true\r\n    }\r\n\r\n    /** un-pause the plugin */\r\n    resume()\r\n    {\r\n        this.paused = false\r\n    }\r\n}","import * as PIXI from 'pixi.js'\r\n\r\nimport { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef {object} LastDrag\r\n * @property {number} x\r\n * @property {number} y\r\n * @property {PIXI.Point} parent\r\n */\r\n\r\n/**\r\n * @typedef DragOptions\r\n * @property {string} [direction=all] direction to drag\r\n * @property {boolean} [pressDrag=true] whether click to drag is active\r\n * @property {boolean} [wheel=true] use wheel to scroll in direction (unless wheel plugin is active)\r\n * @property {number} [wheelScroll=1] number of pixels to scroll with each wheel spin\r\n * @property {boolean} [reverse] reverse the direction of the wheel scroll\r\n * @property {(boolean|string)} [clampWheel=false] clamp wheel(to avoid weird bounce with mouse wheel)\r\n * @property {string} [underflow=center] where to place world if too small for screen\r\n * @property {number} [factor=1] factor to multiply drag to increase the speed of movement\r\n * @property {string} [mouseButtons=all] changes which mouse buttons trigger drag, use: 'all', 'left', right' 'middle', or some combination, like, 'middle-right'; you may want to set viewport.options.disableOnContextMenu if you want to use right-click dragging\r\n * @property {string[]} [keyToPress=null] array containing {@link key|https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code} codes of keys that can be pressed for the drag to be triggered, e.g.: ['ShiftLeft', 'ShiftRight'}.\r\n * @property {boolean} [ignoreKeyToPressOnTouch=false] ignore keyToPress for touch events\r\n */\r\n\r\nconst dragOptions = {\r\n    direction: 'all',\r\n    pressDrag: true,\r\n    wheel: true,\r\n    wheelScroll: 1,\r\n    reverse: false,\r\n    clampWheel: false,\r\n    underflow: 'center',\r\n    factor: 1,\r\n    mouseButtons: 'all',\r\n    keyToPress: null,\r\n    ignoreKeyToPressOnTouch: false\r\n}\r\n\r\n/**\r\n * @private\r\n */\r\nexport class Drag extends Plugin\r\n{\r\n    /**\r\n     * @param {Viewport} parent\r\n     * @param {DragOptions} options\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, dragOptions, options)\r\n        this.moved = false\r\n        this.reverse = this.options.reverse ? 1 : -1\r\n        this.xDirection = !this.options.direction || this.options.direction === 'all' || this.options.direction === 'x'\r\n        this.yDirection = !this.options.direction || this.options.direction === 'all' || this.options.direction === 'y'\r\n        this.keyIsPressed = false\r\n\r\n        this.parseUnderflow()\r\n        this.mouseButtons(this.options.mouseButtons)\r\n        if (this.options.keyToPress) {\r\n            this.handleKeyPresses(this.options.keyToPress)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles keypress events and set the keyIsPressed boolean accordingly\r\n     * @param {array} codes - key codes that can be used to trigger drag event\r\n     */\r\n    handleKeyPresses(codes)\r\n    {\r\n        parent.addEventListener(\"keydown\", e => {\r\n            if (codes.includes(e.code))\r\n                this.keyIsPressed = true\r\n        })\r\n\r\n        parent.addEventListener(\"keyup\", e => {\r\n            if (codes.includes(e.code))\r\n                this.keyIsPressed = false\r\n        })\r\n    }\r\n\r\n    /**\r\n     * initialize mousebuttons array\r\n     * @param {string} buttons\r\n     */\r\n    mouseButtons(buttons)\r\n    {\r\n        if (!buttons || buttons === 'all')\r\n        {\r\n            this.mouse = [true, true, true]\r\n        }\r\n        else\r\n        {\r\n            this.mouse = [\r\n                buttons.indexOf('left') === -1 ? false : true,\r\n                buttons.indexOf('middle') === -1 ? false : true,\r\n                buttons.indexOf('right') === -1 ? false : true\r\n            ]\r\n        }\r\n    }\r\n\r\n    parseUnderflow()\r\n    {\r\n        const clamp = this.options.underflow.toLowerCase()\r\n        if (clamp === 'center')\r\n        {\r\n            this.underflowX = 0\r\n            this.underflowY = 0\r\n        }\r\n        else\r\n        {\r\n            this.underflowX = (clamp.indexOf('left') !== -1) ? -1 : (clamp.indexOf('right') !== -1) ? 1 : 0\r\n            this.underflowY = (clamp.indexOf('top') !== -1) ? -1 : (clamp.indexOf('bottom') !== -1) ? 1 : 0\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    checkButtons(event)\r\n    {\r\n        const isMouse = event.data.pointerType === 'mouse'\r\n        const count = this.parent.input.count()\r\n        if ((count === 1) || (count > 1 && !this.parent.plugins.get('pinch')))\r\n        {\r\n            if (!isMouse || this.mouse[event.data.button])\r\n            {\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    checkKeyPress(event)\r\n    {\r\n        if (!this.options.keyToPress || this.keyIsPressed || (this.options.ignoreKeyToPressOnTouch && event.data.pointerType === 'touch'))\r\n            return true\r\n\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     */\r\n    down(event)\r\n    {\r\n        if (this.paused || !this.options.pressDrag)\r\n        {\r\n            return\r\n        }\r\n        if (this.checkButtons(event) && this.checkKeyPress(event))\r\n        {\r\n            this.last = { x: event.data.global.x, y: event.data.global.y }\r\n            this.current = event.data.pointerId\r\n            return true\r\n        }\r\n        else\r\n        {\r\n            this.last = null\r\n        }\r\n    }\r\n\r\n    get active()\r\n    {\r\n        return this.moved\r\n    }\r\n\r\n    /**\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     */\r\n    move(event)\r\n    {\r\n        if (this.paused || !this.options.pressDrag)\r\n        {\r\n            return\r\n        }\r\n        if (this.last && this.current === event.data.pointerId)\r\n        {\r\n            const x = event.data.global.x\r\n            const y = event.data.global.y\r\n            const count = this.parent.input.count()\r\n            if (count === 1 || (count > 1 && !this.parent.plugins.get('pinch')))\r\n            {\r\n                const distX = x - this.last.x\r\n                const distY = y - this.last.y\r\n                if (this.moved || ((this.xDirection && this.parent.input.checkThreshold(distX)) || (this.yDirection && this.parent.input.checkThreshold(distY))))\r\n                {\r\n                    const newPoint = { x, y }\r\n                    if (this.xDirection)\r\n                    {\r\n                        this.parent.x += (newPoint.x - this.last.x) * this.options.factor\r\n                    }\r\n                    if (this.yDirection)\r\n                    {\r\n                        this.parent.y += (newPoint.y - this.last.y) * this.options.factor\r\n                    }\r\n                    this.last = newPoint\r\n                    if (!this.moved)\r\n                    {\r\n                        this.parent.emit('drag-start', { event: event, screen: new PIXI.Point(this.last.x, this.last.y), world: this.parent.toWorld(new PIXI.Point(this.last.x, this.last.y)), viewport: this.parent})\r\n                    }\r\n                    this.moved = true\r\n                    this.parent.emit('moved', { viewport: this.parent, type: 'drag' })\r\n                    return true\r\n                }\r\n            }\r\n            else\r\n            {\r\n                this.moved = false\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    up(event)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n        const touches = this.parent.input.touches\r\n        if (touches.length === 1)\r\n        {\r\n            const pointer = touches[0]\r\n            if (pointer.last)\r\n            {\r\n                this.last = { x: pointer.last.x, y: pointer.last.y }\r\n                this.current = pointer.id\r\n            }\r\n            this.moved = false\r\n            return true\r\n        }\r\n        else if (this.last)\r\n        {\r\n            if (this.moved)\r\n            {\r\n                const screen = new PIXI.Point(this.last.x, this.last.y)\r\n                this.parent.emit('drag-end', { event: event, screen, world: this.parent.toWorld(screen), viewport: this.parent})\r\n                this.last = null\r\n                this.moved = false\r\n                return true\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {WheelEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    wheel(event)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        if (this.options.wheel)\r\n        {\r\n            const wheel = this.parent.plugins.get('wheel')\r\n            if (!wheel)\r\n            {\r\n                if (this.xDirection)\r\n                {\r\n                    this.parent.x += event.deltaX * this.options.wheelScroll * this.reverse\r\n                }\r\n                if (this.yDirection)\r\n                {\r\n                    this.parent.y += event.deltaY * this.options.wheelScroll * this.reverse\r\n                }\r\n                if (this.options.clampWheel)\r\n                {\r\n                    this.clamp()\r\n                }\r\n                this.parent.emit('wheel-scroll', this.parent)\r\n                this.parent.emit('moved', { viewport: this.parent, type: 'wheel' })\r\n                if (!this.parent.options.passiveWheel)\r\n                {\r\n                    event.preventDefault()\r\n                }\r\n                return true\r\n            }\r\n        }\r\n    }\r\n\r\n    resume()\r\n    {\r\n        this.last = null\r\n        this.paused = false\r\n    }\r\n\r\n    clamp()\r\n    {\r\n        const decelerate = this.parent.plugins.get('decelerate') || {}\r\n        if (this.options.clampWheel !== 'y')\r\n        {\r\n            if (this.parent.screenWorldWidth < this.parent.screenWidth)\r\n            {\r\n                switch (this.underflowX)\r\n                {\r\n                    case -1:\r\n                        this.parent.x = 0\r\n                        break\r\n                    case 1:\r\n                        this.parent.x = (this.parent.screenWidth - this.parent.screenWorldWidth)\r\n                        break\r\n                    default:\r\n                        this.parent.x = (this.parent.screenWidth - this.parent.screenWorldWidth) / 2\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (this.parent.left < 0)\r\n                {\r\n                    this.parent.x = 0\r\n                    decelerate.x = 0\r\n                }\r\n                else if (this.parent.right > this.parent.worldWidth)\r\n                {\r\n                    this.parent.x = -this.parent.worldWidth * this.parent.scale.x + this.parent.screenWidth\r\n                    decelerate.x = 0\r\n                }\r\n            }\r\n        }\r\n        if (this.options.clampWheel !== 'x')\r\n        {\r\n            if (this.parent.screenWorldHeight < this.parent.screenHeight)\r\n            {\r\n                switch (this.underflowY)\r\n                {\r\n                    case -1:\r\n                        this.parent.y = 0\r\n                        break\r\n                    case 1:\r\n                        this.parent.y = (this.parent.screenHeight - this.parent.screenWorldHeight)\r\n                        break\r\n                    default:\r\n                        this.parent.y = (this.parent.screenHeight - this.parent.screenWorldHeight) / 2\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (this.parent.top < 0)\r\n                {\r\n                    this.parent.y = 0\r\n                    decelerate.y = 0\r\n                }\r\n                if (this.parent.bottom > this.parent.worldHeight)\r\n                {\r\n                    this.parent.y = -this.parent.worldHeight * this.parent.scale.y + this.parent.screenHeight\r\n                    decelerate.y = 0\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef {object} PinchOptions\r\n * @property {boolean} [noDrag] disable two-finger dragging\r\n * @property {number} [percent=1.0] percent to modify pinch speed\r\n * @property {PIXI.Point} [center] place this point at center during zoom instead of center of two fingers\r\n */\r\n\r\nconst pinchOptions = {\r\n    noDrag: false,\r\n    percent: 1.0,\r\n    center: null\r\n}\r\n\r\nexport class Pinch extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {PinchOptions} [options]\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, pinchOptions, options)\r\n    }\r\n\r\n    down()\r\n    {\r\n        if (this.parent.input.count() >= 2)\r\n        {\r\n            this.active = true\r\n            return true\r\n        }\r\n    }\r\n\r\n    move(e)\r\n    {\r\n        if (this.paused || !this.active)\r\n        {\r\n            return\r\n        }\r\n\r\n        const x = e.data.global.x\r\n        const y = e.data.global.y\r\n\r\n        const pointers = this.parent.input.touches\r\n        if (pointers.length >= 2)\r\n        {\r\n            const first = pointers[0]\r\n            const second = pointers[1]\r\n            const last = (first.last && second.last) ? Math.sqrt(Math.pow(second.last.x - first.last.x, 2) + Math.pow(second.last.y - first.last.y, 2)) : null\r\n            if (first.id === e.data.pointerId)\r\n            {\r\n                first.last = { x, y, data: e.data }\r\n            }\r\n            else if (second.id === e.data.pointerId)\r\n            {\r\n                second.last = { x, y, data: e.data }\r\n            }\r\n            if (last)\r\n            {\r\n                let oldPoint\r\n                const point = { x: first.last.x + (second.last.x - first.last.x) / 2, y: first.last.y + (second.last.y - first.last.y) / 2 }\r\n                if (!this.options.center)\r\n                {\r\n                    oldPoint = this.parent.toLocal(point)\r\n                }\r\n                const dist = Math.sqrt(Math.pow(second.last.x - first.last.x, 2) + Math.pow(second.last.y - first.last.y, 2))\r\n                const change = ((dist - last) / this.parent.screenWidth) * this.parent.scale.x * this.options.percent\r\n                this.parent.scale.x += change\r\n                this.parent.scale.y += change\r\n                this.parent.emit('zoomed', { viewport: this.parent, type: 'pinch' })\r\n                const clamp = this.parent.plugins.get('clamp-zoom')\r\n                if (clamp)\r\n                {\r\n                    clamp.clamp()\r\n                }\r\n                if (this.options.center)\r\n                {\r\n                    this.parent.moveCenter(this.options.center)\r\n                }\r\n                else\r\n                {\r\n                    const newPoint = this.parent.toGlobal(oldPoint)\r\n                    this.parent.x += point.x - newPoint.x\r\n                    this.parent.y += point.y - newPoint.y\r\n                    this.parent.emit('moved', { viewport: this.parent, type: 'pinch' })\r\n                }\r\n                if (!this.options.noDrag && this.lastCenter)\r\n                {\r\n                    this.parent.x += point.x - this.lastCenter.x\r\n                    this.parent.y += point.y - this.lastCenter.y\r\n                    this.parent.emit('moved', { viewport: this.parent, type: 'pinch' })\r\n                }\r\n                this.lastCenter = point\r\n                this.moved = true\r\n            }\r\n            else\r\n            {\r\n                if (!this.pinching)\r\n                {\r\n                    this.parent.emit('pinch-start', this.parent)\r\n                    this.pinching = true\r\n                }\r\n            }\r\n            return true\r\n        }\r\n    }\r\n\r\n    up()\r\n    {\r\n        if (this.pinching)\r\n        {\r\n            if (this.parent.input.touches.length <= 1)\r\n            {\r\n                this.active = false\r\n                this.lastCenter = null\r\n                this.pinching = false\r\n                this.moved = false\r\n                this.parent.emit('pinch-end', this.parent)\r\n                return true\r\n            }\r\n        }\r\n    }\r\n}","import { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef ClampOptions\r\n * @property {(number|boolean)} [left=false] clamp left; true = 0\r\n * @property {(number|boolean)} [right=false] clamp right; true = viewport.worldWidth\r\n * @property {(number|boolean)} [top=false] clamp top; true = 0\r\n * @property {(number|boolean)} [bottom=false] clamp bottom; true = viewport.worldHeight\r\n * @property {string} [direction] (all, x, or y) using clamps of [0, viewport.worldWidth/viewport.worldHeight]; replaces left/right/top/bottom if set\r\n * @property {string} [underflow=center] where to place world if too small for screen (e.g., top-right, center, none, bottomleft)\r\n */\r\n\r\nconst clampOptions =\r\n{\r\n    left: false,\r\n    right: false,\r\n    top: false,\r\n    bottom: false,\r\n    direction: null,\r\n    underflow: 'center'\r\n}\r\n\r\nexport class Clamp extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {ClampOptions} [options]\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, clampOptions, options)\r\n        if (this.options.direction)\r\n        {\r\n            this.options.left = this.options.direction === 'x' || this.options.direction === 'all' ? true : null\r\n            this.options.right = this.options.direction === 'x' || this.options.direction === 'all' ? true : null\r\n            this.options.top = this.options.direction === 'y' || this.options.direction === 'all' ? true : null\r\n            this.options.bottom = this.options.direction === 'y' || this.options.direction === 'all' ? true : null\r\n        }\r\n        this.parseUnderflow()\r\n        this.last = { x: null, y: null, scaleX: null, scaleY: null }\r\n        this.update()\r\n    }\r\n\r\n    parseUnderflow()\r\n    {\r\n        const clamp = this.options.underflow.toLowerCase()\r\n        if (clamp === 'none')\r\n        {\r\n            this.noUnderflow = true\r\n        }\r\n        else if (clamp === 'center')\r\n        {\r\n            this.underflowX = this.underflowY = 0\r\n            this.noUnderflow = false\r\n        }\r\n        else\r\n        {\r\n            this.underflowX = (clamp.indexOf('left') !== -1) ? -1 : (clamp.indexOf('right') !== -1) ? 1 : 0\r\n            this.underflowY = (clamp.indexOf('top') !== -1) ? -1 : (clamp.indexOf('bottom') !== -1) ? 1 : 0\r\n            this.noUnderflow = false\r\n        }\r\n    }\r\n\r\n    /**\r\n     * handle move events\r\n     * @param {PIXI.interaction.InteractionEvent} event\r\n     * @returns {boolean}\r\n     */\r\n    move()\r\n    {\r\n        this.update()\r\n        return false\r\n    }\r\n\r\n    update()\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        // only clamp on change\r\n        if (this.parent.x === this.last.x && this.parent.y === this.last.y && this.parent.scale.x === this.last.scaleX && this.parent.scale.y === this.last.scaleY)\r\n        {\r\n            return\r\n        }\r\n        const original = { x: this.parent.x, y: this.parent.y }\r\n        const decelerate = this.parent.plugins['decelerate'] || {}\r\n        if (this.options.left !== null || this.options.right !== null)\r\n        {\r\n            let moved = false\r\n            if (this.parent.screenWorldWidth < this.parent.screenWidth)\r\n            {\r\n                if (!this.noUnderflow)\r\n                {\r\n                    switch (this.underflowX)\r\n                    {\r\n                        case -1:\r\n                            if (this.parent.x !== 0)\r\n                            {\r\n                                this.parent.x = 0\r\n                                moved = true\r\n                            }\r\n                            break\r\n                        case 1:\r\n                            if (this.parent.x !== this.parent.screenWidth - this.parent.screenWorldWidth)\r\n                            {\r\n                                this.parent.x = this.parent.screenWidth - this.parent.screenWorldWidth\r\n                                moved = true\r\n                            }\r\n                            break\r\n                        default:\r\n                            if (this.parent.x !== (this.parent.screenWidth - this.parent.screenWorldWidth) / 2)\r\n                            {\r\n                                this.parent.x = (this.parent.screenWidth - this.parent.screenWorldWidth) / 2\r\n                                moved = true\r\n                            }\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (this.options.left !== null)\r\n                {\r\n                    if (this.parent.left < (this.options.left === true ? 0 : this.options.left))\r\n                    {\r\n                        this.parent.x = -(this.options.left === true ? 0 : this.options.left) * this.parent.scale.x\r\n                        decelerate.x = 0\r\n                        moved = true\r\n                    }\r\n                }\r\n                if (this.options.right !== null)\r\n                {\r\n                    if (this.parent.right > (this.options.right === true ? this.parent.worldWidth : this.options.right))\r\n                    {\r\n                        this.parent.x = -(this.options.right === true ? this.parent.worldWidth : this.options.right) * this.parent.scale.x + this.parent.screenWidth\r\n                        decelerate.x = 0\r\n                        moved = true\r\n                    }\r\n                }\r\n            }\r\n            if (moved)\r\n            {\r\n                this.parent.emit('moved', { viewport: this.parent, original, type: 'clamp-x' })\r\n            }\r\n        }\r\n        if (this.options.top !== null || this.options.bottom !== null)\r\n        {\r\n            let moved = false\r\n            if (this.parent.screenWorldHeight < this.parent.screenHeight)\r\n            {\r\n                if (!this.noUnderflow)\r\n                {\r\n                    switch (this.underflowY)\r\n                    {\r\n                        case -1:\r\n                            if (this.parent.y !== 0)\r\n                            {\r\n                                this.parent.y = 0\r\n                                moved = true\r\n                            }\r\n                            break\r\n                        case 1:\r\n                            if (this.parent.y !== this.parent.screenHeight - this.parent.screenWorldHeight)\r\n                            {\r\n                                this.parent.y = (this.parent.screenHeight - this.parent.screenWorldHeight)\r\n                                moved = true\r\n                            }\r\n                            break\r\n                        default:\r\n                            if (this.parent.y !== (this.parent.screenHeight - this.parent.screenWorldHeight) / 2)\r\n                            {\r\n                                this.parent.y = (this.parent.screenHeight - this.parent.screenWorldHeight) / 2\r\n                                moved = true\r\n                            }\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (this.options.top !== null)\r\n                {\r\n                    if (this.parent.top < (this.options.top === true ? 0 : this.options.top))\r\n                    {\r\n                        this.parent.y = -(this.options.top === true ? 0 : this.options.top) * this.parent.scale.y\r\n                        decelerate.y = 0\r\n                        moved = true\r\n                    }\r\n                }\r\n                if (this.options.bottom !== null)\r\n                {\r\n                    if (this.parent.bottom > (this.options.bottom === true ? this.parent.worldHeight : this.options.bottom))\r\n                    {\r\n                        this.parent.y = -(this.options.bottom === true ? this.parent.worldHeight : this.options.bottom) * this.parent.scale.y + this.parent.screenHeight\r\n                        decelerate.y = 0\r\n                        moved = true\r\n                    }\r\n                }\r\n            }\r\n            if (moved)\r\n            {\r\n                this.parent.emit('moved', { viewport: this.parent, original, type: 'clamp-y' })\r\n            }\r\n        }\r\n        this.last.x = this.parent.x\r\n        this.last.y = this.parent.y\r\n        this.last.scaleX = this.parent.scale.x\r\n        this.last.scaleY = this.parent.scale.y\r\n    }\r\n\r\n    reset() \r\n    {\r\n        this.update();\r\n    }\r\n}","import { Plugin } from './plugin'\r\n\r\n/**\r\n * use either minimum width/height or minimum scale\r\n * @typedef {object} ClampZoomOptions\r\n * @property {number} [minWidth] minimum width\r\n * @property {number} [minHeight] minimum height\r\n * @property {number} [maxWidth] maximum width\r\n * @property {number} [maxHeight] maximum height\r\n * @property {number} [minScale] minimum scale\r\n * @property {number} [maxScale] minimum scale\r\n */\r\n\r\nconst clampZoomOptions = {\r\n    minWidth: null,\r\n    minHeight: null,\r\n    maxWidth: null,\r\n    maxHeight: null,\r\n    minScale: null,\r\n    maxScale: null\r\n}\r\n\r\nexport class ClampZoom extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {ClampZoomOptions} [options]\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, clampZoomOptions, options)\r\n        this.clamp()\r\n    }\r\n\r\n    resize()\r\n    {\r\n        this.clamp()\r\n    }\r\n\r\n    clamp()\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        if (this.options.minWidth || this.options.minHeight || this.options.maxWidth || this.options.maxHeight)\r\n        {\r\n            let width = this.parent.worldScreenWidth\r\n            let height = this.parent.worldScreenHeight\r\n            if (this.options.minWidth !== null && width < this.options.minWidth)\r\n            {\r\n                const original = this.parent.scale.x\r\n                this.parent.fitWidth(this.options.minWidth, false, false, true)\r\n                this.parent.scale.y *= this.parent.scale.x / original\r\n                width = this.parent.worldScreenWidth\r\n                height = this.parent.worldScreenHeight\r\n                this.parent.emit('zoomed', { viewport: this.parent, type: 'clamp-zoom' })\r\n            }\r\n            if (this.options.maxWidth !== null && width > this.options.maxWidth)\r\n            {\r\n                const original = this.parent.scale.x\r\n                this.parent.fitWidth(this.options.maxWidth, false, false, true)\r\n                this.parent.scale.y *= this.parent.scale.x / original\r\n                width = this.parent.worldScreenWidth\r\n                height = this.parent.worldScreenHeight\r\n                this.parent.emit('zoomed', { viewport: this.parent, type: 'clamp-zoom' })\r\n            }\r\n            if (this.options.minHeight !== null && height < this.options.minHeight)\r\n            {\r\n                const original = this.parent.scale.y\r\n                this.parent.fitHeight(this.options.minHeight, false, false, true)\r\n                this.parent.scale.x *= this.parent.scale.y / original\r\n                width = this.parent.worldScreenWidth\r\n                height = this.parent.worldScreenHeight\r\n                this.parent.emit('zoomed', { viewport: this.parent, type: 'clamp-zoom' })\r\n            }\r\n            if (this.options.maxHeight !== null && height > this.options.maxHeight)\r\n            {\r\n                const original = this.parent.scale.y\r\n                this.parent.fitHeight(this.options.maxHeight, false, false, true)\r\n                this.parent.scale.x *= this.parent.scale.y / original\r\n                this.parent.emit('zoomed', { viewport: this.parent, type: 'clamp-zoom' })\r\n            }\r\n        }\r\n        else\r\n        {\r\n            let scale = this.parent.scale.x\r\n            if (this.options.minScale !== null && scale < this.options.minScale)\r\n            {\r\n                scale = this.options.minScale\r\n            }\r\n            if (this.options.maxScale !== null && scale > this.options.maxScale)\r\n            {\r\n                scale = this.options.maxScale\r\n            }\r\n            if (scale !== this.parent.scale.x) {\r\n                this.parent.scale.set(scale)\r\n                this.parent.emit('zoomed', { viewport: this.parent, type: 'clamp-zoom' })\r\n            }\r\n        }\r\n    }\r\n\r\n    reset()\r\n    {\r\n        this.clamp()\r\n    }\r\n}\r\n","import { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef {object} DecelerateOptions\r\n * @property {number} [friction=0.95] percent to decelerate after movement\r\n * @property {number} [bounce=0.8] percent to decelerate when past boundaries (only applicable when viewport.bounce() is active)\r\n * @property {number} [minSpeed=0.01] minimum velocity before stopping/reversing acceleration\r\n */\r\n\r\nconst decelerateOptions = {\r\n    friction: 0.95,\r\n    bounce: 0.8,\r\n    minSpeed: 0.01\r\n}\r\n\r\nexport class Decelerate extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {DecelerateOptions} [options]\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, decelerateOptions, options)\r\n        this.saved = []\r\n        this.reset()\r\n        this.parent.on('moved', data => this.moved(data))\r\n    }\r\n\r\n    destroy()\r\n    {\r\n        this.parent\r\n    }\r\n\r\n    down()\r\n    {\r\n        this.saved = []\r\n        this.x = this.y = false\r\n    }\r\n\r\n    isActive()\r\n    {\r\n        return this.x || this.y\r\n    }\r\n\r\n    move()\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        const count = this.parent.input.count()\r\n        if (count === 1 || (count > 1 && !this.parent.plugins.get('pinch')))\r\n        {\r\n            this.saved.push({ x: this.parent.x, y: this.parent.y, time: performance.now() })\r\n            if (this.saved.length > 60)\r\n            {\r\n                this.saved.splice(0, 30)\r\n            }\r\n        }\r\n    }\r\n\r\n    moved(data)\r\n    {\r\n        if (this.saved.length)\r\n        {\r\n            const last = this.saved[this.saved.length - 1]\r\n            if (data.type === 'clamp-x')\r\n            {\r\n                if (last.x === data.original.x)\r\n                {\r\n                    last.x = this.parent.x\r\n                }\r\n            }\r\n            else if (data.type === 'clamp-y')\r\n            {\r\n                if (last.y === data.original.y)\r\n                {\r\n                    last.y = this.parent.y\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    up()\r\n    {\r\n        if (this.parent.input.count() === 0 && this.saved.length)\r\n        {\r\n            const now = performance.now()\r\n            for (let save of this.saved)\r\n            {\r\n                if (save.time >= now - 100)\r\n                {\r\n                    const time = now - save.time\r\n                    this.x = (this.parent.x - save.x) / time\r\n                    this.y = (this.parent.y - save.y) / time\r\n                    this.percentChangeX = this.percentChangeY = this.options.friction\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * manually activate plugin\r\n     * @param {object} options\r\n     * @param {number} [options.x]\r\n     * @param {number} [options.y]\r\n     */\r\n    activate(options)\r\n    {\r\n        options = options || {}\r\n        if (typeof options.x !== 'undefined')\r\n        {\r\n            this.x = options.x\r\n            this.percentChangeX = this.options.friction\r\n        }\r\n        if (typeof options.y !== 'undefined')\r\n        {\r\n            this.y = options.y\r\n            this.percentChangeY = this.options.friction\r\n        }\r\n    }\r\n\r\n    update(elapsed)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        let moved\r\n        if (this.x)\r\n        {\r\n            this.parent.x += this.x * elapsed\r\n            this.x *= this.percentChangeX\r\n            if (Math.abs(this.x) < this.options.minSpeed)\r\n            {\r\n                this.x = 0\r\n            }\r\n            moved = true\r\n        }\r\n        if (this.y)\r\n        {\r\n            this.parent.y += this.y * elapsed\r\n            this.y *= this.percentChangeY\r\n            if (Math.abs(this.y) < this.options.minSpeed)\r\n            {\r\n                this.y = 0\r\n            }\r\n            moved = true\r\n        }\r\n        if (moved)\r\n        {\r\n            this.parent.emit('moved', { viewport: this.parent, type: 'decelerate' })\r\n        }\r\n    }\r\n\r\n    reset()\r\n    {\r\n        this.x = this.y = null\r\n    }\r\n}","\n/*\n\tCopyright © 2001 Robert Penner\n\tAll rights reserved.\n\n\tRedistribution and use in source and binary forms, with or without modification, \n\tare permitted provided that the following conditions are met:\n\n\tRedistributions of source code must retain the above copyright notice, this list of \n\tconditions and the following disclaimer.\n\tRedistributions in binary form must reproduce the above copyright notice, this list \n\tof conditions and the following disclaimer in the documentation and/or other materials \n\tprovided with the distribution.\n\n\tNeither the name of the author nor the names of contributors may be used to endorse \n\tor promote products derived from this software without specific prior written permission.\n\n\tTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY \n\tEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF\n\tMERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n\tCOPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\tEXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE\n\tGOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED \n\tAND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n\tNEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED \n\tOF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n(function() {\n  var penner, umd;\n\n  umd = function(factory) {\n    if (typeof exports === 'object') {\n      return module.exports = factory;\n    } else if (typeof define === 'function' && define.amd) {\n      return define([], factory);\n    } else {\n      return this.penner = factory;\n    }\n  };\n\n  penner = {\n    linear: function(t, b, c, d) {\n      return c * t / d + b;\n    },\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n    easeInOutQuad: function(t, b, c, d) {\n      if ((t /= d / 2) < 1) {\n        return c / 2 * t * t + b;\n      } else {\n        return -c / 2 * ((--t) * (t - 2) - 1) + b;\n      }\n    },\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n    easeOutCubic: function(t, b, c, d) {\n      return c * ((t = t / d - 1) * t * t + 1) + b;\n    },\n    easeInOutCubic: function(t, b, c, d) {\n      if ((t /= d / 2) < 1) {\n        return c / 2 * t * t * t + b;\n      } else {\n        return c / 2 * ((t -= 2) * t * t + 2) + b;\n      }\n    },\n    easeInQuart: function(t, b, c, d) {\n      return c * (t /= d) * t * t * t + b;\n    },\n    easeOutQuart: function(t, b, c, d) {\n      return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n    },\n    easeInOutQuart: function(t, b, c, d) {\n      if ((t /= d / 2) < 1) {\n        return c / 2 * t * t * t * t + b;\n      } else {\n        return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n      }\n    },\n    easeInQuint: function(t, b, c, d) {\n      return c * (t /= d) * t * t * t * t + b;\n    },\n    easeOutQuint: function(t, b, c, d) {\n      return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n    },\n    easeInOutQuint: function(t, b, c, d) {\n      if ((t /= d / 2) < 1) {\n        return c / 2 * t * t * t * t * t + b;\n      } else {\n        return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n      }\n    },\n    easeInSine: function(t, b, c, d) {\n      return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n    },\n    easeOutSine: function(t, b, c, d) {\n      return c * Math.sin(t / d * (Math.PI / 2)) + b;\n    },\n    easeInOutSine: function(t, b, c, d) {\n      return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n    },\n    easeInExpo: function(t, b, c, d) {\n      if (t === 0) {\n        return b;\n      } else {\n        return c * Math.pow(2, 10 * (t / d - 1)) + b;\n      }\n    },\n    easeOutExpo: function(t, b, c, d) {\n      if (t === d) {\n        return b + c;\n      } else {\n        return c * (-Math.pow(2, -10 * t / d) + 1) + b;\n      }\n    },\n    easeInOutExpo: function(t, b, c, d) {\n      if (t === 0) {\n        b;\n      }\n      if (t === d) {\n        b + c;\n      }\n      if ((t /= d / 2) < 1) {\n        return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n      } else {\n        return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n      }\n    },\n    easeInCirc: function(t, b, c, d) {\n      return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n    },\n    easeOutCirc: function(t, b, c, d) {\n      return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n    },\n    easeInOutCirc: function(t, b, c, d) {\n      if ((t /= d / 2) < 1) {\n        return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n      } else {\n        return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n      }\n    },\n    easeInElastic: function(t, b, c, d) {\n      var a, p, s;\n      s = 1.70158;\n      p = 0;\n      a = c;\n      if (t === 0) {\n        b;\n      } else if ((t /= d) === 1) {\n        b + c;\n      }\n      if (!p) {\n        p = d * .3;\n      }\n      if (a < Math.abs(c)) {\n        a = c;\n        s = p / 4;\n      } else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n      return -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n    },\n    easeOutElastic: function(t, b, c, d) {\n      var a, p, s;\n      s = 1.70158;\n      p = 0;\n      a = c;\n      if (t === 0) {\n        b;\n      } else if ((t /= d) === 1) {\n        b + c;\n      }\n      if (!p) {\n        p = d * .3;\n      }\n      if (a < Math.abs(c)) {\n        a = c;\n        s = p / 4;\n      } else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n      return a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * (2 * Math.PI) / p) + c + b;\n    },\n    easeInOutElastic: function(t, b, c, d) {\n      var a, p, s;\n      s = 1.70158;\n      p = 0;\n      a = c;\n      if (t === 0) {\n        b;\n      } else if ((t /= d / 2) === 2) {\n        b + c;\n      }\n      if (!p) {\n        p = d * (.3 * 1.5);\n      }\n      if (a < Math.abs(c)) {\n        a = c;\n        s = p / 4;\n      } else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n      if (t < 1) {\n        return -.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n      } else {\n        return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * .5 + c + b;\n      }\n    },\n    easeInBack: function(t, b, c, d, s) {\n      if (s === void 0) {\n        s = 1.70158;\n      }\n      return c * (t /= d) * t * ((s + 1) * t - s) + b;\n    },\n    easeOutBack: function(t, b, c, d, s) {\n      if (s === void 0) {\n        s = 1.70158;\n      }\n      return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n    },\n    easeInOutBack: function(t, b, c, d, s) {\n      if (s === void 0) {\n        s = 1.70158;\n      }\n      if ((t /= d / 2) < 1) {\n        return c / 2 * (t * t * (((s *= 1.525) + 1) * t - s)) + b;\n      } else {\n        return c / 2 * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2) + b;\n      }\n    },\n    easeInBounce: function(t, b, c, d) {\n      var v;\n      v = penner.easeOutBounce(d - t, 0, c, d);\n      return c - v + b;\n    },\n    easeOutBounce: function(t, b, c, d) {\n      if ((t /= d) < 1 / 2.75) {\n        return c * (7.5625 * t * t) + b;\n      } else if (t < 2 / 2.75) {\n        return c * (7.5625 * (t -= 1.5 / 2.75) * t + .75) + b;\n      } else if (t < 2.5 / 2.75) {\n        return c * (7.5625 * (t -= 2.25 / 2.75) * t + .9375) + b;\n      } else {\n        return c * (7.5625 * (t -= 2.625 / 2.75) * t + .984375) + b;\n      }\n    },\n    easeInOutBounce: function(t, b, c, d) {\n      var v;\n      if (t < d / 2) {\n        v = penner.easeInBounce(t * 2, 0, c, d);\n        return v * .5 + b;\n      } else {\n        v = penner.easeOutBounce(t * 2 - d, 0, c, d);\n        return v * .5 + c * .5 + b;\n      }\n    }\n  };\n\n  umd(penner);\n\n}).call(this);\n","import Penner from 'penner'\r\n\r\n/**\r\n * returns correct Penner equation using string or Function\r\n * @param {(function|string)} [ease]\r\n * @param {defaults} default penner equation to use if none is provided\r\n */\r\nexport default function ease(ease, defaults)\r\n{\r\n    if (!ease)\r\n    {\r\n        return Penner[defaults]\r\n    }\r\n    else if (typeof ease === 'function')\r\n    {\r\n        return ease\r\n    }\r\n    else if (typeof ease === 'string')\r\n    {\r\n        return Penner[ease]\r\n    }\r\n}","import * as PIXI from 'pixi.js'\r\nimport { Plugin } from './plugin'\r\nimport ease from '../ease'\r\n\r\n/**\r\n * @typedef {options} BounceOptions\r\n * @property {string} [sides=all] all, horizontal, vertical, or combination of top, bottom, right, left (e.g., 'top-bottom-right')\r\n * @property {number} [friction=0.5] friction to apply to decelerate if active\r\n * @property {number} [time=150] time in ms to finish bounce\r\n * @property {object} [bounceBox] use this bounceBox instead of (0, 0, viewport.worldWidth, viewport.worldHeight)\r\n * @property {number} [bounceBox.x=0]\r\n * @property {number} [bounceBox.y=0]\r\n * @property {number} [bounceBox.width=viewport.worldWidth]\r\n * @property {number} [bounceBox.height=viewport.worldHeight]\r\n * @property {string|function} [ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)\r\n * @property {string} [underflow=center] (top/bottom/center and left/right/center, or center) where to place world if too small for screen\r\n */\r\n\r\nconst bounceOptions = {\r\n    sides: 'all',\r\n    friction: 0.5,\r\n    time: 150,\r\n    ease: 'easeInOutSine',\r\n    underflow: 'center',\r\n    bounceBox: null\r\n}\r\n\r\nexport class Bounce extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {BounceOptions} [options]\r\n     * @fires bounce-start-x\r\n     * @fires bounce.end-x\r\n     * @fires bounce-start-y\r\n     * @fires bounce-end-y\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, bounceOptions, options)\r\n        this.ease = ease(this.options.ease, 'easeInOutSine')\r\n        if (this.options.sides)\r\n        {\r\n            if (this.options.sides === 'all')\r\n            {\r\n                this.top = this.bottom = this.left = this.right = true\r\n            }\r\n            else if (this.options.sides === 'horizontal')\r\n            {\r\n                this.right = this.left = true\r\n            }\r\n            else if (this.options.sides === 'vertical')\r\n            {\r\n                this.top = this.bottom = true\r\n            }\r\n            else\r\n            {\r\n                this.top = this.options.sides.indexOf('top') !== -1\r\n                this.bottom = this.options.sides.indexOf('bottom') !== -1\r\n                this.left = this.options.sides.indexOf('left') !== -1\r\n                this.right = this.options.sides.indexOf('right') !== -1\r\n            }\r\n        }\r\n        this.parseUnderflow()\r\n        this.last = {}\r\n        this.reset()\r\n    }\r\n\r\n    parseUnderflow()\r\n    {\r\n        const clamp = this.options.underflow.toLowerCase()\r\n        if (clamp === 'center')\r\n        {\r\n            this.underflowX = 0\r\n            this.underflowY = 0\r\n        }\r\n        else\r\n        {\r\n            this.underflowX = (clamp.indexOf('left') !== -1) ? -1 : (clamp.indexOf('right') !== -1) ? 1 : 0\r\n            this.underflowY = (clamp.indexOf('top') !== -1) ? -1 : (clamp.indexOf('bottom') !== -1) ? 1 : 0\r\n        }\r\n    }\r\n\r\n    isActive()\r\n    {\r\n        return this.toX !== null || this.toY !== null\r\n    }\r\n\r\n    down()\r\n    {\r\n        this.toX = this.toY = null\r\n    }\r\n\r\n    up()\r\n    {\r\n        this.bounce()\r\n    }\r\n\r\n    update(elapsed)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        this.bounce()\r\n        if (this.toX)\r\n        {\r\n            const toX = this.toX\r\n            toX.time += elapsed\r\n            this.parent.emit('moved', { viewport: this.parent, type: 'bounce-x' })\r\n            if (toX.time >= this.options.time)\r\n            {\r\n                this.parent.x = toX.end\r\n                this.toX = null\r\n                this.parent.emit('bounce-x-end', this.parent)\r\n            }\r\n            else\r\n            {\r\n                this.parent.x = this.ease(toX.time, toX.start, toX.delta, this.options.time)\r\n            }\r\n        }\r\n        if (this.toY)\r\n        {\r\n            const toY = this.toY\r\n            toY.time += elapsed\r\n            this.parent.emit('moved', { viewport: this.parent, type: 'bounce-y' })\r\n            if (toY.time >= this.options.time)\r\n            {\r\n                this.parent.y = toY.end\r\n                this.toY = null\r\n                this.parent.emit('bounce-y-end', this.parent)\r\n            }\r\n            else\r\n            {\r\n                this.parent.y = this.ease(toY.time, toY.start, toY.delta, this.options.time)\r\n            }\r\n        }\r\n    }\r\n\r\n    calcUnderflowX()\r\n    {\r\n        let x\r\n        switch (this.underflowX)\r\n        {\r\n            case -1:\r\n                x = 0\r\n                break\r\n            case 1:\r\n                x = (this.parent.screenWidth - this.parent.screenWorldWidth)\r\n                break\r\n            default:\r\n                x = (this.parent.screenWidth - this.parent.screenWorldWidth) / 2\r\n        }\r\n        return x\r\n    }\r\n\r\n    calcUnderflowY()\r\n    {\r\n        let y\r\n        switch (this.underflowY)\r\n        {\r\n            case -1:\r\n                y = 0\r\n                break\r\n            case 1:\r\n                y = (this.parent.screenHeight - this.parent.screenWorldHeight)\r\n                break\r\n            default:\r\n                y = (this.parent.screenHeight - this.parent.screenWorldHeight) / 2\r\n        }\r\n        return y\r\n    }\r\n\r\n    oob()\r\n    {\r\n        const box = this.options.bounceBox\r\n        if (box) {\r\n            const x1 = typeof box.x === 'undefined' ? 0 : box.x\r\n            const y1 = typeof box.y === 'undefined' ? 0 : box.y\r\n            const width = typeof box.width === 'undefined' ? this.parent.worldWidth : box.width\r\n            const height = typeof box.height === 'undefined' ? this.parent.worldHeight : box.height\r\n            return {\r\n                left: this.parent.left < x1,\r\n                right: this.parent.right > width,\r\n                top: this.parent.top < y1,\r\n                bottom: this.parent.bottom > height,\r\n                topLeft: new PIXI.Point(\r\n                    x1 * this.parent.scale.x,\r\n                    y1 * this.parent.scale.y\r\n                ),\r\n                bottomRight: new PIXI.Point(\r\n                    width * this.parent.scale.x - this.parent.screenWidth,\r\n                    height * this.parent.scale.y - this.parent.screenHeight\r\n                )\r\n            }\r\n        }\r\n        return {\r\n            left: this.parent.left < 0,\r\n            right: this.parent.right > this.parent.worldWidth,\r\n            top: this.parent.top < 0,\r\n            bottom: this.parent.bottom > this.parent.worldHeight,\r\n            topLeft: new PIXI.Point(0, 0),\r\n            bottomRight: new PIXI.Point(\r\n                this.parent.worldWidth * this.parent.scale.x - this.parent.screenWidth,\r\n                this.parent.worldHeight * this.parent.scale.y - this.parent.screenHeight\r\n            )\r\n        }\r\n    }\r\n\r\n    bounce()\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        let oob\r\n        let decelerate = this.parent.plugins.get('decelerate')\r\n        if (decelerate && (decelerate.x || decelerate.y))\r\n        {\r\n            if ((decelerate.x && decelerate.percentChangeX === decelerate.options.friction) || (decelerate.y && decelerate.percentChangeY === decelerate.options.friction))\r\n            {\r\n                oob = this.oob()\r\n                if ((oob.left && this.left) || (oob.right && this.right))\r\n                {\r\n                    decelerate.percentChangeX = this.options.friction\r\n                }\r\n                if ((oob.top && this.top) || (oob.bottom && this.bottom))\r\n                {\r\n                    decelerate.percentChangeY = this.options.friction\r\n                }\r\n            }\r\n        }\r\n        const drag = this.parent.plugins.get('drag') || {}\r\n        const pinch = this.parent.plugins.get('pinch') || {}\r\n        decelerate = decelerate || {}\r\n        if (!drag.active && !pinch.active && ((!this.toX || !this.toY) && (!decelerate.x || !decelerate.y)))\r\n        {\r\n            oob = oob || this.oob()\r\n            const topLeft = oob.topLeft\r\n            const bottomRight = oob.bottomRight\r\n            if (!this.toX && !decelerate.x)\r\n            {\r\n                let x = null\r\n                if (oob.left && this.left)\r\n                {\r\n                    x = (this.parent.screenWorldWidth < this.parent.screenWidth) ? this.calcUnderflowX() : -topLeft.x\r\n                }\r\n                else if (oob.right && this.right)\r\n                {\r\n                    x = (this.parent.screenWorldWidth < this.parent.screenWidth) ? this.calcUnderflowX() : -bottomRight.x\r\n                }\r\n                if (x !== null && this.parent.x !== x)\r\n                {\r\n                    this.toX = { time: 0, start: this.parent.x, delta: x - this.parent.x, end: x }\r\n                    this.parent.emit('bounce-x-start', this.parent)\r\n                }\r\n            }\r\n            if (!this.toY && !decelerate.y)\r\n            {\r\n                let y = null\r\n                if (oob.top && this.top)\r\n                {\r\n                    y = (this.parent.screenWorldHeight < this.parent.screenHeight) ? this.calcUnderflowY() : -topLeft.y\r\n                }\r\n                else if (oob.bottom && this.bottom)\r\n                {\r\n                    y = (this.parent.screenWorldHeight < this.parent.screenHeight) ? this.calcUnderflowY() : -bottomRight.y\r\n                }\r\n                if (y !== null && this.parent.y !== y)\r\n                {\r\n                    this.toY = { time: 0, start: this.parent.y, delta: y - this.parent.y, end: y }\r\n                    this.parent.emit('bounce-y-start', this.parent)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    reset()\r\n    {\r\n        this.toX = this.toY = null\r\n        this.bounce()\r\n    }\r\n}","import { Plugin } from './plugin'\r\nimport ease from '../ease'\r\n\r\n/**\r\n * @typedef SnapOptions\r\n * @property {boolean} [topLeft] snap to the top-left of viewport instead of center\r\n * @property {number} [friction=0.8] friction/frame to apply if decelerate is active\r\n * @property {number} [time=1000]\r\n * @property {string|function} [ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)\r\n * @property {boolean} [interrupt=true] pause snapping with any user input on the viewport\r\n * @property {boolean} [removeOnComplete] removes this plugin after snapping is complete\r\n * @property {boolean} [removeOnInterrupt] removes this plugin if interrupted by any user input\r\n * @property {boolean} [forceStart] starts the snap immediately regardless of whether the viewport is at the desired location\r\n */\r\n\r\nconst snapOptions = {\r\n    topLeft: false,\r\n    friction: 0.8,\r\n    time: 1000,\r\n    ease: 'easeInOutSine',\r\n    interrupt: true,\r\n    removeOnComplete: false,\r\n    removeOnInterrupt: false,\r\n    forceStart: false\r\n}\r\n\r\nexport class Snap extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {number} x\r\n     * @param {number} y\r\n     * @param {SnapOptions} [options]\r\n     * @event snap-start(Viewport) emitted each time a snap animation starts\r\n     * @event snap-restart(Viewport) emitted each time a snap resets because of a change in viewport size\r\n     * @event snap-end(Viewport) emitted each time snap reaches its target\r\n     * @event snap-remove(Viewport) emitted if snap plugin is removed\r\n     */\r\n    constructor(parent, x, y, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, snapOptions, options)\r\n        this.ease = ease(options.ease, 'easeInOutSine')\r\n        this.x = x\r\n        this.y = y\r\n        if (this.options.forceStart)\r\n        {\r\n            this.snapStart()\r\n        }\r\n    }\r\n\r\n    snapStart()\r\n    {\r\n        this.percent = 0\r\n        this.snapping = { time: 0 }\r\n        const current = this.options.topLeft ? this.parent.corner : this.parent.center\r\n        this.deltaX = this.x - current.x\r\n        this.deltaY = this.y - current.y\r\n        this.startX = current.x\r\n        this.startY = current.y\r\n        this.parent.emit('snap-start', this.parent)\r\n    }\r\n\r\n    wheel()\r\n    {\r\n        if (this.options.removeOnInterrupt)\r\n        {\r\n            this.parent.plugins.remove('snap')\r\n        }\r\n    }\r\n\r\n    down()\r\n    {\r\n        if (this.options.removeOnInterrupt)\r\n        {\r\n            this.parent.plugins.remove('snap')\r\n        }\r\n        else if (this.options.interrupt)\r\n        {\r\n            this.snapping = null\r\n        }\r\n    }\r\n\r\n    up()\r\n    {\r\n        if (this.parent.input.count() === 0)\r\n        {\r\n            const decelerate = this.parent.plugins.get('decelerate')\r\n            if (decelerate && (decelerate.x || decelerate.y))\r\n            {\r\n                decelerate.percentChangeX = decelerate.percentChangeY = this.options.friction\r\n            }\r\n        }\r\n    }\r\n\r\n    update(elapsed)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n        if (this.options.interrupt && this.parent.input.count() !== 0)\r\n        {\r\n            return\r\n        }\r\n        if (!this.snapping)\r\n        {\r\n            const current = this.options.topLeft ? this.parent.corner : this.parent.center\r\n            if (current.x !== this.x || current.y !== this.y)\r\n            {\r\n                this.snapStart()\r\n            }\r\n        }\r\n        else\r\n        {\r\n            const snapping = this.snapping\r\n            snapping.time += elapsed\r\n            let finished, x, y\r\n            if (snapping.time > this.options.time)\r\n            {\r\n                finished = true\r\n                x = this.startX + this.deltaX\r\n                y = this.startY + this.deltaY\r\n            }\r\n            else\r\n            {\r\n                const percent = this.ease(snapping.time, 0, 1, this.options.time)\r\n                x = this.startX + this.deltaX * percent\r\n                y = this.startY + this.deltaY * percent\r\n            }\r\n            if (this.options.topLeft)\r\n            {\r\n                this.parent.moveCorner(x, y)\r\n            }\r\n            else\r\n            {\r\n                this.parent.moveCenter(x, y)\r\n            }\r\n            this.parent.emit('moved', { viewport: this.parent, type: 'snap' })\r\n            if (finished)\r\n            {\r\n                if (this.options.removeOnComplete)\r\n                {\r\n                    this.parent.plugins.remove('snap')\r\n                }\r\n                this.parent.emit('snap-end', this.parent)\r\n                this.snapping = null\r\n            }\r\n        }\r\n    }\r\n}","import { Plugin } from './plugin'\r\nimport ease from '../ease'\r\n\r\n/**\r\n * @typedef {Object} SnapZoomOptions\r\n * @property {number} [width=0] the desired width to snap (to maintain aspect ratio, choose only width or height)\r\n * @property {number} [height=0] the desired height to snap (to maintain aspect ratio, choose only width or height)\r\n * @property {number} [time=1000] time for snapping in ms\r\n * @property {(string|function)} [ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)\r\n * @property {PIXI.Point} [center] place this point at center during zoom instead of center of the viewport\r\n * @property {boolean} [interrupt=true] pause snapping with any user input on the viewport\r\n * @property {boolean} [removeOnComplete] removes this plugin after snapping is complete\r\n * @property {boolean} [removeOnInterrupt] removes this plugin if interrupted by any user input\r\n * @property {boolean} [forceStart] starts the snap immediately regardless of whether the viewport is at the desired zoom\r\n * @property {boolean} [noMove] zoom but do not move\r\n */\r\n\r\nconst snapZoomOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    time: 1000,\r\n    ease: 'easeInOutSine',\r\n    center: null,\r\n    interrupt: true,\r\n    removeOnComplete: false,\r\n    removeOnInterrupts: false,\r\n    forceStart: false,\r\n    noMove: false\r\n}\r\n\r\nexport class SnapZoom extends Plugin\r\n{\r\n    /**\r\n     * @param {Viewport} parent\r\n     * @param {SnapZoomOptions} options\r\n     * @event snap-zoom-start(Viewport) emitted each time a fit animation starts\r\n     * @event snap-zoom-end(Viewport) emitted each time fit reaches its target\r\n     * @event snap-zoom-end(Viewport) emitted each time fit reaches its target\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, snapZoomOptions, options)\r\n        this.ease = ease(this.options.ease)\r\n        if (this.options.width > 0)\r\n        {\r\n            this.xScale = parent.screenWidth / this.options.width\r\n        }\r\n        if (this.options.height > 0)\r\n        {\r\n            this.yScale = parent.screenHeight / this.options.height\r\n        }\r\n        this.xIndependent = this.xScale ? true : false\r\n        this.yIndependent = this.yScale ? true : false\r\n        this.xScale = this.xIndependent ? this.xScale : this.yScale\r\n        this.yScale = this.yIndependent ? this.yScale : this.xScale\r\n\r\n        if (this.options.time === 0)\r\n        {\r\n            parent.container.scale.x = this.xScale\r\n            parent.container.scale.y = this.yScale\r\n            if (this.options.removeOnComplete)\r\n            {\r\n                this.parent.plugins.remove('snap-zoom')\r\n            }\r\n        }\r\n        else if (options.forceStart)\r\n        {\r\n            this.createSnapping()\r\n        }\r\n    }\r\n\r\n    createSnapping()\r\n    {\r\n        const scale = this.parent.scale\r\n        this.snapping = { time: 0, startX: scale.x, startY: scale.y, deltaX: this.xScale - scale.x, deltaY: this.yScale - scale.y }\r\n        this.parent.emit('snap-zoom-start', this.parent)\r\n    }\r\n\r\n    resize()\r\n    {\r\n        this.snapping = null\r\n\r\n        if (this.options.width > 0)\r\n        {\r\n            this.xScale = this.parent.screenWidth / this.options.width\r\n        }\r\n        if (this.options.height > 0)\r\n        {\r\n            this.yScale = this.parent.screenHeight / this.options.height\r\n        }\r\n        this.xScale = this.xIndependent ? this.xScale : this.yScale\r\n        this.yScale = this.yIndependent ? this.yScale : this.xScale\r\n    }\r\n\r\n    wheel()\r\n    {\r\n        if (this.options.removeOnInterrupt)\r\n        {\r\n            this.parent.plugins.remove('snap-zoom')\r\n        }\r\n    }\r\n\r\n    down()\r\n    {\r\n        if (this.options.removeOnInterrupt)\r\n        {\r\n            this.parent.plugins.remove('snap-zoom')\r\n        }\r\n        else if (this.options.interrupt)\r\n        {\r\n            this.snapping = null\r\n        }\r\n    }\r\n\r\n    update(elapsed)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n        if (this.options.interrupt && this.parent.input.count() !== 0)\r\n        {\r\n            return\r\n        }\r\n\r\n        let oldCenter\r\n        if (!this.options.center && !this.options.noMove)\r\n        {\r\n            oldCenter = this.parent.center\r\n        }\r\n        if (!this.snapping)\r\n        {\r\n            if (this.parent.scale.x !== this.xScale || this.parent.scale.y !== this.yScale)\r\n            {\r\n                this.createSnapping()\r\n            }\r\n        }\r\n        else if (this.snapping)\r\n        {\r\n            const snapping = this.snapping\r\n            snapping.time += elapsed\r\n            if (snapping.time >= this.options.time)\r\n            {\r\n                this.parent.scale.set(this.xScale, this.yScale)\r\n                if (this.options.removeOnComplete)\r\n                {\r\n                    this.parent.plugins.remove('snap-zoom')\r\n                }\r\n                this.parent.emit('snap-zoom-end', this.parent)\r\n                this.snapping = null\r\n            }\r\n            else\r\n            {\r\n                const snapping = this.snapping\r\n                this.parent.scale.x = this.ease(snapping.time, snapping.startX, snapping.deltaX, this.options.time)\r\n                this.parent.scale.y = this.ease(snapping.time, snapping.startY, snapping.deltaY, this.options.time)\r\n            }\r\n            const clamp = this.parent.plugins.get('clamp-zoom')\r\n            if (clamp)\r\n            {\r\n                clamp.clamp()\r\n            }\r\n            if (!this.options.noMove)\r\n            {\r\n                if (!this.options.center)\r\n                {\r\n                    this.parent.moveCenter(oldCenter)\r\n                }\r\n                else\r\n                {\r\n                    this.parent.moveCenter(this.options.center)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    resume()\r\n    {\r\n        this.snapping = null\r\n        super.resume()\r\n    }\r\n}","import { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef {object} FollowOptions\r\n * @property {number} [speed=0] to follow in pixels/frame (0=teleport to location)\r\n * @property {number} [acceleration] set acceleration to accelerate and decelerate at this rate; speed cannot be 0 to use acceleration\r\n * @property {number} [radius] radius (in world coordinates) of center circle where movement is allowed without moving the viewport\r\n */\r\n\r\nconst followOptions = {\r\n    speed: 0,\r\n    acceleration: null,\r\n    radius: null\r\n}\r\n\r\nexport class Follow extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {PIXI.DisplayObject} target to follow\r\n     * @param {FollowOptions} [options]\r\n     */\r\n    constructor(parent, target, options = {})\r\n    {\r\n        super(parent)\r\n        this.target = target\r\n        this.options = Object.assign({}, followOptions, options)\r\n        this.velocity = { x: 0, y: 0 }\r\n    }\r\n\r\n    update(elapsed)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        const center = this.parent.center\r\n        let toX = this.target.x,\r\n            toY = this.target.y\r\n        if (this.options.radius)\r\n        {\r\n            const distance = Math.sqrt(Math.pow(this.target.y - center.y, 2) + Math.pow(this.target.x - center.x, 2))\r\n            if (distance > this.options.radius)\r\n            {\r\n                const angle = Math.atan2(this.target.y - center.y, this.target.x - center.x)\r\n                toX = this.target.x - Math.cos(angle) * this.options.radius\r\n                toY = this.target.y - Math.sin(angle) * this.options.radius\r\n            }\r\n            else\r\n            {\r\n                return\r\n            }\r\n        }\r\n\r\n        const deltaX = toX - center.x\r\n        const deltaY = toY - center.y\r\n        if (deltaX || deltaY)\r\n        {\r\n            if (this.options.speed)\r\n            {\r\n                if (this.options.acceleration)\r\n                {\r\n                    const angle = Math.atan2(toY - center.y, toX - center.x)\r\n                    const distance = Math.sqrt(Math.pow(deltaX, 2) + Math.pow(deltaY, 2))\r\n                    if (distance)\r\n                    {\r\n                        const decelerationDistance = (Math.pow(this.velocity.x, 2) + Math.pow(this.velocity.y, 2)) / (2 * this.options.acceleration)\r\n                        if (distance > decelerationDistance)\r\n                        {\r\n                            this.velocity = {\r\n                                x: Math.min(this.velocity.x + this.options.acceleration * elapsed, this.options.speed),\r\n                                y: Math.min(this.velocity.y + this.options.acceleration * elapsed, this.options.speed)\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            this.velocity = {\r\n                                x: Math.max(this.velocity.x - this.options.acceleration * this.options.speed, 0),\r\n                                y: Math.max(this.velocity.y - this.options.acceleration * this.options.speed, 0)\r\n                            }\r\n                        }\r\n                        const changeX = Math.cos(angle) * this.velocity.x\r\n                        const changeY = Math.sin(angle) * this.velocity.y\r\n                        const x = Math.abs(changeX) > Math.abs(deltaX) ? toX : center.x + changeX\r\n                        const y = Math.abs(changeY) > Math.abs(deltaY) ? toY : center.y + changeY\r\n                        this.parent.moveCenter(x, y)\r\n                        this.parent.emit('moved', { viewport: this.parent, type: 'follow' })\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    const angle = Math.atan2(toY - center.y, toX - center.x)\r\n                    const changeX = Math.cos(angle) * this.options.speed\r\n                    const changeY = Math.sin(angle) * this.options.speed\r\n                    const x = Math.abs(changeX) > Math.abs(deltaX) ? toX : center.x + changeX\r\n                    const y = Math.abs(changeY) > Math.abs(deltaY) ? toY : center.y + changeY\r\n                    this.parent.moveCenter(x, y)\r\n                    this.parent.emit('moved', { viewport: this.parent, type: 'follow' })\r\n                }\r\n            }\r\n            else\r\n            {\r\n                this.parent.moveCenter(toX, toY)\r\n                this.parent.emit('moved', { viewport: this.parent, type: 'follow' })\r\n            }\r\n        }\r\n    }\r\n}","import { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef WheelOptions\r\n * @property {number} [percent=0.1] percent to scroll with each spin\r\n * @property {number} [smooth] smooth the zooming by providing the number of frames to zoom between wheel spins\r\n * @property {boolean} [interrupt=true] stop smoothing with any user input on the viewport\r\n * @property {boolean} [reverse] reverse the direction of the scroll\r\n * @property {PIXI.Point} [center] place this point at center during zoom instead of current mouse position\r\n */\r\n\r\nconst wheelOptions = {\r\n    percent: 0.1,\r\n    smooth: false,\r\n    interrupt: true,\r\n    reverse: false,\r\n    center: null\r\n}\r\n\r\nexport class Wheel extends Plugin\r\n{\r\n    /**\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {WheelOptions} [options]\r\n     * @event wheel({wheel: {dx, dy, dz}, event, viewport})\r\n     */\r\n    constructor(parent, options = {})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, wheelOptions, options)\r\n    }\r\n\r\n    down()\r\n    {\r\n        if (this.options.interrupt)\r\n        {\r\n            this.smoothing = null\r\n        }\r\n    }\r\n\r\n    update()\r\n    {\r\n        if (this.smoothing)\r\n        {\r\n            const point = this.smoothingCenter\r\n            const change = this.smoothing\r\n            let oldPoint\r\n            if (!this.options.center)\r\n            {\r\n                oldPoint = this.parent.toLocal(point)\r\n            }\r\n            this.parent.scale.x += change.x\r\n            this.parent.scale.y += change.y\r\n            this.parent.emit('zoomed', { viewport: this.parent, type: 'wheel' })\r\n            const clamp = this.parent.plugins.get('clamp-zoom')\r\n            if (clamp)\r\n            {\r\n                clamp.clamp()\r\n            }\r\n            if (this.options.center)\r\n            {\r\n                this.parent.moveCenter(this.options.center)\r\n            }\r\n            else\r\n            {\r\n                const newPoint = this.parent.toGlobal(oldPoint)\r\n                this.parent.x += point.x - newPoint.x\r\n                this.parent.y += point.y - newPoint.y\r\n            }\r\n            this.parent.emit('moved', { viewport: this.parent, type: 'wheel' })\r\n            this.smoothingCount++\r\n            if (this.smoothingCount >= this.options.smooth)\r\n            {\r\n                this.smoothing = null\r\n            }\r\n        }\r\n    }\r\n\r\n    wheel(e)\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        let point = this.parent.input.getPointerPosition(e)\r\n        const sign = this.options.reverse ? -1 : 1\r\n        const step = sign * -e.deltaY * (e.deltaMode ? 120 : 1) / 500\r\n        const change = Math.pow(2, (1 + this.options.percent) * step)\r\n        if (this.options.smooth)\r\n        {\r\n            const original = {\r\n                x: this.smoothing ? this.smoothing.x * (this.options.smooth - this.smoothingCount) : 0,\r\n                y: this.smoothing ? this.smoothing.y * (this.options.smooth - this.smoothingCount) : 0\r\n            }\r\n            this.smoothing = {\r\n                x: ((this.parent.scale.x + original.x) * change - this.parent.scale.x) / this.options.smooth,\r\n                y: ((this.parent.scale.y + original.y) * change - this.parent.scale.y) / this.options.smooth\r\n            }\r\n            this.smoothingCount = 0\r\n            this.smoothingCenter = point\r\n        }\r\n        else\r\n        {\r\n            let oldPoint\r\n            if (!this.options.center)\r\n            {\r\n                oldPoint = this.parent.toLocal(point)\r\n            }\r\n            this.parent.scale.x *= change\r\n            this.parent.scale.y *= change\r\n            this.parent.emit('zoomed', { viewport: this.parent, type: 'wheel' })\r\n            const clamp = this.parent.plugins.get('clamp-zoom')\r\n            if (clamp)\r\n            {\r\n                clamp.clamp()\r\n            }\r\n            if (this.options.center)\r\n            {\r\n                this.parent.moveCenter(this.options.center)\r\n            }\r\n            else\r\n            {\r\n                const newPoint = this.parent.toGlobal(oldPoint)\r\n                this.parent.x += point.x - newPoint.x\r\n                this.parent.y += point.y - newPoint.y\r\n            }\r\n        }\r\n        this.parent.emit('moved', { viewport: this.parent, type: 'wheel' })\r\n        this.parent.emit('wheel', { wheel: { dx: e.deltaX, dy: e.deltaY, dz: e.deltaZ }, event: e, viewport: this.parent })\r\n        if (!this.parent.options.passiveWheel)\r\n        {\r\n            return true\r\n        }\r\n    }\r\n}\r\n","import { Plugin } from './plugin'\r\n\r\n/**\r\n * @typedef MouseEdgesOptions\r\n * @property {number} [radius] distance from center of screen in screen pixels\r\n * @property {number} [distance] distance from all sides in screen pixels\r\n * @property {number} [top] alternatively, set top distance (leave unset for no top scroll)\r\n * @property {number} [bottom] alternatively, set bottom distance (leave unset for no top scroll)\r\n * @property {number} [left] alternatively, set left distance (leave unset for no top scroll)\r\n * @property {number} [right] alternatively, set right distance (leave unset for no top scroll)\r\n * @property {number} [speed=8] speed in pixels/frame to scroll viewport\r\n * @property {boolean} [reverse] reverse direction of scroll\r\n * @property {boolean} [noDecelerate] don't use decelerate plugin even if it's installed\r\n * @property {boolean} [linear] if using radius, use linear movement (+/- 1, +/- 1) instead of angled movement (Math.cos(angle from center), Math.sin(angle from center))\r\n * @property {boolean} [allowButtons] allows plugin to continue working even when there's a mousedown event\r\n */\r\n\r\nconst mouseEdgesOptions = {\r\n    radius: null,\r\n    distance: null,\r\n    top: null,\r\n    bottom: null,\r\n    left: null,\r\n    right: null,\r\n    speed: 8,\r\n    reverse: false,\r\n    noDecelerate: false,\r\n    linear: false,\r\n    allowButtons: false\r\n}\r\n\r\nexport class MouseEdges extends Plugin\r\n{\r\n    /**\r\n     * Scroll viewport when mouse hovers near one of the edges.\r\n     * @private\r\n     * @param {Viewport} parent\r\n     * @param {MouseEdgeOptions} [options]\r\n     * @event mouse-edge-start(Viewport) emitted when mouse-edge starts\r\n     * @event mouse-edge-end(Viewport) emitted when mouse-edge ends\r\n     */\r\n    constructor(parent, options={})\r\n    {\r\n        super(parent)\r\n        this.options = Object.assign({}, mouseEdgesOptions, options)\r\n        this.reverse = this.options.reverse ? 1 : -1\r\n        this.radiusSquared = Math.pow(this.options.radius, 2)\r\n        this.resize()\r\n    }\r\n\r\n    resize()\r\n    {\r\n        const distance = this.options.distance\r\n        if (distance !== null)\r\n        {\r\n            this.left = distance\r\n            this.top = distance\r\n            this.right = this.parent.worldScreenWidth - distance\r\n            this.bottom = this.parent.worldScreenHeight - distance\r\n        }\r\n        else if (!this.radius)\r\n        {\r\n            this.left = this.options.left\r\n            this.top = this.options.top\r\n            this.right = this.options.right === null ? null : this.parent.worldScreenWidth - this.options.right\r\n            this.bottom = this.options.bottom === null ? null : this.parent.worldScreenHeight - this.options.bottom\r\n        }\r\n    }\r\n\r\n    down()\r\n    {\r\n        if (!this.options.allowButtons)\r\n        {\r\n            this.horizontal = this.vertical = null\r\n        }\r\n    }\r\n\r\n    move(event)\r\n    {\r\n        if ((event.data.pointerType !== 'mouse' && event.data.identifier !== 1) || (!this.options.allowButtons && event.data.buttons !== 0))\r\n        {\r\n            return\r\n        }\r\n        const x = event.data.global.x\r\n        const y = event.data.global.y\r\n\r\n        if (this.radiusSquared)\r\n        {\r\n            const center = this.parent.toScreen(this.parent.center)\r\n            const distance = Math.pow(center.x - x, 2) + Math.pow(center.y - y, 2)\r\n            if (distance >= this.radiusSquared)\r\n            {\r\n                const angle = Math.atan2(center.y - y, center.x - x)\r\n                if (this.options.linear)\r\n                {\r\n                    this.horizontal = Math.round(Math.cos(angle)) * this.options.speed * this.reverse * (60 / 1000)\r\n                    this.vertical = Math.round(Math.sin(angle)) * this.options.speed * this.reverse * (60 / 1000)\r\n                }\r\n                else\r\n                {\r\n                    this.horizontal = Math.cos(angle) * this.options.speed * this.reverse * (60 / 1000)\r\n                    this.vertical = Math.sin(angle) * this.options.speed * this.reverse * (60 / 1000)\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (this.horizontal)\r\n                {\r\n                    this.decelerateHorizontal()\r\n                }\r\n                if (this.vertical)\r\n                {\r\n                    this.decelerateVertical()\r\n                }\r\n                this.horizontal = this.vertical = 0\r\n            }\r\n        }\r\n        else\r\n        {\r\n            if (this.left !== null && x < this.left)\r\n            {\r\n                this.horizontal = 1 * this.reverse * this.options.speed * (60 / 1000)\r\n            }\r\n            else if (this.right !== null && x > this.right)\r\n            {\r\n                this.horizontal = -1 * this.reverse * this.options.speed * (60 / 1000)\r\n            }\r\n            else\r\n            {\r\n                this.decelerateHorizontal()\r\n                this.horizontal = 0\r\n            }\r\n            if (this.top !== null && y < this.top)\r\n            {\r\n                this.vertical = 1 * this.reverse * this.options.speed * (60 / 1000)\r\n            }\r\n            else if (this.bottom !== null && y > this.bottom)\r\n            {\r\n                this.vertical = -1 * this.reverse * this.options.speed * (60 / 1000)\r\n            }\r\n            else\r\n            {\r\n                this.decelerateVertical()\r\n                this.vertical = 0\r\n            }\r\n        }\r\n    }\r\n\r\n    decelerateHorizontal()\r\n    {\r\n        const decelerate = this.parent.plugins.get('decelerate')\r\n        if (this.horizontal && decelerate && !this.options.noDecelerate)\r\n        {\r\n            decelerate.activate({ x: (this.horizontal * this.options.speed * this.reverse) / (1000 / 60) })\r\n        }\r\n    }\r\n\r\n    decelerateVertical()\r\n    {\r\n        const decelerate = this.parent.plugins.get('decelerate')\r\n        if (this.vertical && decelerate && !this.options.noDecelerate)\r\n        {\r\n            decelerate.activate({ y: (this.vertical * this.options.speed * this.reverse) / (1000 / 60)})\r\n        }\r\n    }\r\n\r\n    up()\r\n    {\r\n        if (this.horizontal)\r\n        {\r\n            this.decelerateHorizontal()\r\n        }\r\n        if (this.vertical)\r\n        {\r\n            this.decelerateVertical()\r\n        }\r\n        this.horizontal = this.vertical = null\r\n    }\r\n\r\n    update()\r\n    {\r\n        if (this.paused)\r\n        {\r\n            return\r\n        }\r\n\r\n        if (this.horizontal || this.vertical)\r\n        {\r\n            const center = this.parent.center\r\n            if (this.horizontal)\r\n            {\r\n                center.x += this.horizontal * this.options.speed\r\n            }\r\n            if (this.vertical)\r\n            {\r\n                center.y += this.vertical * this.options.speed\r\n            }\r\n            this.parent.moveCenter(center)\r\n            this.parent.emit('moved', { viewport: this.parent, type: 'mouse-edges' })\r\n        }\r\n    }\r\n}","import * as PIXI from 'pixi.js'\r\n\r\nimport { InputManager } from './input-manager'\r\nimport { PluginManager } from './plugin-manager'\r\nimport { Drag } from './plugins/drag'\r\nimport { Pinch } from './plugins/pinch'\r\nimport { Clamp } from './plugins/clamp'\r\nimport { ClampZoom } from './plugins/clamp-zoom'\r\nimport { Decelerate } from './plugins/decelerate'\r\nimport { Bounce } from './plugins/bounce'\r\nimport { Snap } from './plugins/snap'\r\nimport { SnapZoom } from './plugins/snap-zoom'\r\nimport { Follow } from './plugins/follow'\r\nimport { Wheel } from './plugins/wheel'\r\nimport { MouseEdges } from './plugins/mouse-edges'\r\nexport { Plugin } from './plugins/plugin'\r\n\r\n/**\r\n * @typedef {object} ViewportOptions\r\n * @property {number} [screenWidth=window.innerWidth]\r\n * @property {number} [screenHeight=window.innerHeight]\r\n * @property {number} [worldWidth=this.width]\r\n * @property {number} [worldHeight=this.height]\r\n * @property {number} [threshold=5] number of pixels to move to trigger an input event (e.g., drag, pinch) or disable a clicked event\r\n * @property {boolean} [passiveWheel=true] whether the 'wheel' event is set to passive (note: if false, e.preventDefault() will be called when wheel is used over the viewport)\r\n * @property {boolean} [stopPropagation=false] whether to stopPropagation of events that impact the viewport (except wheel events, see options.passiveWheel)\r\n * @property {HitArea} [forceHitArea] change the default hitArea from world size to a new value\r\n * @property {boolean} [noTicker] set this if you want to manually call update() function on each frame\r\n * @property {PIXI.Ticker} [ticker=PIXI.Ticker.shared] use this PIXI.ticker for updates\r\n * @property {PIXI.InteractionManager} [interaction=null] InteractionManager, available from instantiated WebGLRenderer/CanvasRenderer.plugins.interaction - used to calculate pointer postion relative to canvas location on screen\r\n * @property {HTMLElement} [divWheel=document.body] div to attach the wheel event\r\n * @property {boolean} [disableOnContextMenu] remove oncontextmenu=() => {} from the divWheel element\r\n */\r\n\r\nconst viewportOptions = {\r\n    screenWidth: window.innerWidth,\r\n    screenHeight: window.innerHeight,\r\n    worldWidth: null,\r\n    worldHeight: null,\r\n    threshold: 5,\r\n    passiveWheel: true,\r\n    stopPropagation: false,\r\n    forceHitArea: null,\r\n    noTicker: false,\r\n    interaction: null,\r\n    disableOnContextMenu: false\r\n}\r\n\r\n/**\r\n * Main class to use when creating a Viewport\r\n */\r\nexport class Viewport extends PIXI.Container\r\n{\r\n    /**\r\n     * @param {ViewportOptions} [options]\r\n     * @fires clicked\r\n     * @fires drag-start\r\n     * @fires drag-end\r\n     * @fires drag-remove\r\n     * @fires pinch-start\r\n     * @fires pinch-end\r\n     * @fires pinch-remove\r\n     * @fires snap-start\r\n     * @fires snap-end\r\n     * @fires snap-remove\r\n     * @fires snap-zoom-start\r\n     * @fires snap-zoom-end\r\n     * @fires snap-zoom-remove\r\n     * @fires bounce-x-start\r\n     * @fires bounce-x-end\r\n     * @fires bounce-y-start\r\n     * @fires bounce-y-end\r\n     * @fires bounce-remove\r\n     * @fires wheel\r\n     * @fires wheel-remove\r\n     * @fires wheel-scroll\r\n     * @fires wheel-scroll-remove\r\n     * @fires mouse-edge-start\r\n     * @fires mouse-edge-end\r\n     * @fires mouse-edge-remove\r\n     * @fires moved\r\n     * @fires moved-end\r\n     * @fires zoomed\r\n     * @fires zoomed-end\r\n     * @fires frame-end\r\n     */\r\n    constructor(options = {})\r\n    {\r\n        super()\r\n        this.options = Object.assign({}, viewportOptions, options)\r\n\r\n        // needed to pull this out of viewportOptions because of pixi.js v4 support (which changed from PIXI.ticker.shared to PIXI.Ticker.shared...sigh)\r\n        if (options.ticker)\r\n        {\r\n            this.options.ticker = options.ticker\r\n        }\r\n        else\r\n        {\r\n            // to avoid Rollup transforming our import, save pixi namespace in a variable\r\n            // from here: https://github.com/pixijs/pixi.js/issues/5757\r\n            let ticker\r\n            const pixiNS = PIXI\r\n            if (parseInt(/^(\\d+)\\./.exec(PIXI.VERSION)[1]) < 5)\r\n            {\r\n                ticker = pixiNS.ticker.shared;\r\n            }\r\n            else\r\n            {\r\n                ticker = pixiNS.Ticker.shared;\r\n            }\r\n            this.options.ticker = options.ticker || ticker\r\n        }\r\n\r\n        /** @type {number} */\r\n        this.screenWidth = this.options.screenWidth\r\n\r\n        /** @type {number} */\r\n        this.screenHeight = this.options.screenHeight\r\n\r\n        this._worldWidth = this.options.worldWidth\r\n        this._worldHeight = this.options.worldHeight\r\n        this.forceHitArea = this.options.forceHitArea\r\n\r\n        /**\r\n         * number of pixels to move to trigger an input event (e.g., drag, pinch) or disable a clicked event\r\n         * @type {number}\r\n         */\r\n        this.threshold = this.options.threshold\r\n\r\n        this.options.divWheel = this.options.divWheel || document.body\r\n\r\n        if (this.options.disableOnContextMenu)\r\n        {\r\n            this.options.divWheel.oncontextmenu = e => e.preventDefault()\r\n        }\r\n\r\n        if (!this.options.noTicker)\r\n        {\r\n            this.tickerFunction = () => this.update(this.options.ticker.elapsedMS)\r\n            this.options.ticker.add(this.tickerFunction)\r\n        }\r\n\r\n        this.input = new InputManager(this)\r\n\r\n        /**\r\n         * Use this to add user plugins or access existing plugins (e.g., to pause, resume, or remove them)\r\n         * @type {PluginManager}\r\n         */\r\n        this.plugins = new PluginManager(this)\r\n    }\r\n\r\n    /**\r\n     * overrides PIXI.Container's destroy to also remove the 'wheel' and PIXI.Ticker listeners\r\n     * @param {(object|boolean)} [options] - Options parameter. A boolean will act as if all options have been set to that value\r\n     * @param {boolean} [options.children=false] - if set to true, all the children will have their destroy method called as well. 'options' will be passed on to those calls.\r\n     * @param {boolean} [options.texture=false] - Only used for child Sprites if options.children is set to true. Should it destroy the texture of the child sprite\r\n     * @param {boolean} [options.baseTexture=false] - Only used for child Sprites if options.children is set to true. Should it destroy the base texture of the child sprite     */\r\n    destroy(options)\r\n    {\r\n        if (!this.options.noTicker)\r\n        {\r\n            this.options.ticker.remove(this.tickerFunction)\r\n        }\r\n        this.input.destroy()\r\n        super.destroy(options)\r\n    }\r\n\r\n    /**\r\n     * update viewport on each frame\r\n     * by default, you do not need to call this unless you set options.noTicker=true\r\n     * @param {number} elapsed time in milliseconds since last update\r\n     */\r\n    update(elapsed)\r\n    {\r\n        if (!this.pause)\r\n        {\r\n            this.plugins.update(elapsed)\r\n\r\n            if (this.lastViewport)\r\n            {\r\n                // check for moved-end event\r\n                if (this.lastViewport.x !== this.x || this.lastViewport.y !== this.y)\r\n                {\r\n                    this.moving = true\r\n                }\r\n                else\r\n                {\r\n                    if (this.moving)\r\n                    {\r\n                        this.emit('moved-end', this)\r\n                        this.moving = false\r\n                    }\r\n                }\r\n                // check for zoomed-end event\r\n                if (this.lastViewport.scaleX !== this.scale.x || this.lastViewport.scaleY !== this.scale.y)\r\n                {\r\n                    this.zooming = true\r\n                }\r\n                else\r\n                {\r\n                    if (this.zooming)\r\n                    {\r\n                        this.emit('zoomed-end', this)\r\n                        this.zooming = false\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!this.forceHitArea)\r\n            {\r\n                this._hitAreaDefault = new PIXI.Rectangle(this.left, this.top, this.worldScreenWidth, this.worldScreenHeight)\r\n                this.hitArea = this._hitAreaDefault\r\n            }\r\n\r\n            this._dirty = this._dirty || !this.lastViewport ||\r\n                this.lastViewport.x !== this.x || this.lastViewport.y !== this.y ||\r\n                this.lastViewport.scaleX !== this.scale.x || this.lastViewport.scaleY !== this.scale.y\r\n\r\n            this.lastViewport = {\r\n                x: this.x,\r\n                y: this.y,\r\n                scaleX: this.scale.x,\r\n                scaleY: this.scale.y\r\n            }\r\n            this.emit('frame-end', this)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * use this to set screen and world sizes--needed for pinch/wheel/clamp/bounce\r\n     * @param {number} [screenWidth=window.innerWidth]\r\n     * @param {number} [screenHeight=window.innerHeight]\r\n     * @param {number} [worldWidth]\r\n     * @param {number} [worldHeight]\r\n     */\r\n    resize(screenWidth = window.innerWidth, screenHeight = window.innerHeight, worldWidth, worldHeight)\r\n    {\r\n        this.screenWidth = screenWidth\r\n        this.screenHeight = screenHeight\r\n        if (typeof worldWidth !== 'undefined')\r\n        {\r\n            this._worldWidth = worldWidth\r\n        }\r\n        if (typeof worldHeight !== 'undefined')\r\n        {\r\n            this._worldHeight = worldHeight\r\n        }\r\n        this.plugins.resize()\r\n    }\r\n\r\n    /**\r\n     * world width in pixels\r\n     * @type {number}\r\n     */\r\n    get worldWidth()\r\n    {\r\n        if (this._worldWidth)\r\n        {\r\n            return this._worldWidth\r\n        }\r\n        else\r\n        {\r\n            return this.width / this.scale.x\r\n        }\r\n    }\r\n    set worldWidth(value)\r\n    {\r\n        this._worldWidth = value\r\n        this.plugins.resize()\r\n    }\r\n\r\n    /**\r\n     * world height in pixels\r\n     * @type {number}\r\n     */\r\n    get worldHeight()\r\n    {\r\n        if (this._worldHeight)\r\n        {\r\n            return this._worldHeight\r\n        }\r\n        else\r\n        {\r\n            return this.height / this.scale.y\r\n        }\r\n    }\r\n    set worldHeight(value)\r\n    {\r\n        this._worldHeight = value\r\n        this.plugins.resize()\r\n    }\r\n\r\n    /**\r\n     * get visible bounds of viewport\r\n     * @returns {PIXI.Rectangle}\r\n     */\r\n    getVisibleBounds()\r\n    {\r\n        return new PIXI.Rectangle(this.left, this.top, this.worldScreenWidth, this.worldScreenHeight)\r\n    }\r\n\r\n    /**\r\n     * change coordinates from screen to world\r\n     * @param {(number|PIXI.Point)} x or point\r\n     * @param {number} [y]\r\n     * @return {PIXI.Point}\r\n     */\r\n    toWorld(x, y)\r\n    {\r\n        if (arguments.length === 2)\r\n        {\r\n            return this.toLocal(new PIXI.Point(x, y))\r\n        }\r\n        else\r\n        {\r\n            return this.toLocal(x)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * change coordinates from world to screen\r\n     * @param {(number|PIXI.Point)} x or point\r\n     * @param {number} [y]\r\n     * @return {PIXI.Point}\r\n     */\r\n    toScreen(x, y)\r\n    {\r\n        if (arguments.length === 2)\r\n        {\r\n            return this.toGlobal(new PIXI.Point(x, y))\r\n        }\r\n        else\r\n        {\r\n            return this.toGlobal(x)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * screen width in world coordinates\r\n     * @type {number}\r\n     */\r\n    get worldScreenWidth()\r\n    {\r\n        return this.screenWidth / this.scale.x\r\n    }\r\n\r\n    /**\r\n     * screen height in world coordinates\r\n     * @type {number}\r\n     */\r\n    get worldScreenHeight()\r\n    {\r\n        return this.screenHeight / this.scale.y\r\n    }\r\n\r\n    /**\r\n     * world width in screen coordinates\r\n     * @type {number}\r\n     */\r\n    get screenWorldWidth()\r\n    {\r\n        return this.worldWidth * this.scale.x\r\n    }\r\n\r\n    /**\r\n     * world height in screen coordinates\r\n     * @type {number}\r\n     */\r\n    get screenWorldHeight()\r\n    {\r\n        return this.worldHeight * this.scale.y\r\n    }\r\n\r\n    /**\r\n     * center of screen in world coordinates\r\n     * @type {PIXI.Point}\r\n     */\r\n    get center()\r\n    {\r\n        return new PIXI.Point(this.worldScreenWidth / 2 - this.x / this.scale.x, this.worldScreenHeight / 2 - this.y / this.scale.y)\r\n    }\r\n    set center(value)\r\n    {\r\n        this.moveCenter(value)\r\n    }\r\n\r\n    /**\r\n     * move center of viewport to point\r\n     * @param {(number|PIXI.Point)} x or point\r\n     * @param {number} [y]\r\n     * @return {Viewport} this\r\n     */\r\n    moveCenter()\r\n    {\r\n        let x, y\r\n        if (!isNaN(arguments[0]))\r\n        {\r\n            x = arguments[0]\r\n            y = arguments[1]\r\n        }\r\n        else\r\n        {\r\n            x = arguments[0].x\r\n            y = arguments[0].y\r\n        }\r\n        this.position.set((this.worldScreenWidth / 2 - x) * this.scale.x, (this.worldScreenHeight / 2 - y) * this.scale.y)\r\n        this.plugins.reset()\r\n        this.dirty = true\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * top-left corner of Viewport\r\n     * @type {PIXI.Point}\r\n     */\r\n    get corner()\r\n    {\r\n        return new PIXI.Point(-this.x / this.scale.x, -this.y / this.scale.y)\r\n    }\r\n    set corner(value)\r\n    {\r\n        this.moveCorner(value)\r\n    }\r\n\r\n    /**\r\n     * move viewport's top-left corner; also clamps and resets decelerate and bounce (as needed)\r\n     * @param {(number|PIXI.Point)} x or point\r\n     * @param {number} [y]\r\n     * @return {Viewport} this\r\n     */\r\n    moveCorner(x, y)\r\n    {\r\n        if (arguments.length === 1)\r\n        {\r\n            this.position.set(-x.x * this.scale.x, -x.y * this.scale.y)\r\n        }\r\n        else\r\n        {\r\n            this.position.set(-x * this.scale.x, -y * this.scale.y)\r\n        }\r\n        this.plugins.reset()\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * change zoom so the width fits in the viewport\r\n     * @param {number} [width=this.worldWidth] in world coordinates\r\n     * @param {boolean} [center] maintain the same center\r\n     * @param {boolean} [scaleY=true] whether to set scaleY=scaleX\r\n     * @param {boolean} [noClamp] whether to disable clamp-zoom\r\n     * @returns {Viewport} this\r\n     */\r\n    fitWidth(width, center, scaleY = true, noClamp)\r\n    {\r\n        let save\r\n        if (center)\r\n        {\r\n            save = this.center\r\n        }\r\n        this.scale.x = this.screenWidth / width\r\n\r\n        if (scaleY)\r\n        {\r\n            this.scale.y = this.scale.x\r\n        }\r\n\r\n        const clampZoom = this.plugins.get('clamp-zoom')\r\n        if (!noClamp && clampZoom)\r\n        {\r\n            clampZoom.clamp()\r\n        }\r\n\r\n        if (center)\r\n        {\r\n            this.moveCenter(save)\r\n        }\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * change zoom so the height fits in the viewport\r\n     * @param {number} [height=this.worldHeight] in world coordinates\r\n     * @param {boolean} [center] maintain the same center of the screen after zoom\r\n     * @param {boolean} [scaleX=true] whether to set scaleX = scaleY\r\n     * @param {boolean} [noClamp] whether to disable clamp-zoom\r\n     * @returns {Viewport} this\r\n     */\r\n    fitHeight(height, center, scaleX = true, noClamp)\r\n    {\r\n        let save\r\n        if (center)\r\n        {\r\n            save = this.center\r\n        }\r\n        this.scale.y = this.screenHeight / height\r\n\r\n        if (scaleX)\r\n        {\r\n            this.scale.x = this.scale.y\r\n        }\r\n\r\n        const clampZoom = this.plugins.get('clamp-zoom')\r\n        if (!noClamp && clampZoom)\r\n        {\r\n            clampZoom.clamp()\r\n        }\r\n\r\n        if (center)\r\n        {\r\n            this.moveCenter(save)\r\n        }\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * change zoom so it fits the entire world in the viewport\r\n     * @param {boolean} center maintain the same center of the screen after zoom\r\n     * @returns {Viewport} this\r\n     */\r\n    fitWorld(center)\r\n    {\r\n        let save\r\n        if (center)\r\n        {\r\n            save = this.center\r\n        }\r\n        this.scale.x = this.screenWidth / this.worldWidth\r\n        this.scale.y = this.screenHeight / this.worldHeight\r\n        if (this.scale.x < this.scale.y)\r\n        {\r\n            this.scale.y = this.scale.x\r\n        }\r\n        else\r\n        {\r\n            this.scale.x = this.scale.y\r\n        }\r\n\r\n        const clampZoom = this.plugins.get('clamp-zoom')\r\n        if (clampZoom)\r\n        {\r\n            clampZoom.clamp()\r\n        }\r\n\r\n        if (center)\r\n        {\r\n            this.moveCenter(save)\r\n        }\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * change zoom so it fits the size or the entire world in the viewport\r\n     * @param {boolean} [center] maintain the same center of the screen after zoom\r\n     * @param {number} [width=this.worldWidth] desired width\r\n     * @param {number} [height=this.worldHeight] desired height\r\n     * @returns {Viewport} this\r\n     */\r\n    fit(center, width = this.worldWidth, height = this.worldHeight)\r\n    {\r\n        let save\r\n        if (center)\r\n        {\r\n            save = this.center\r\n        }\r\n        this.scale.x = this.screenWidth / width\r\n        this.scale.y = this.screenHeight / height\r\n        if (this.scale.x < this.scale.y)\r\n        {\r\n            this.scale.y = this.scale.x\r\n        }\r\n        else\r\n        {\r\n            this.scale.x = this.scale.y\r\n        }\r\n        const clampZoom = this.plugins.get('clamp-zoom')\r\n        if (clampZoom)\r\n        {\r\n            clampZoom.clamp()\r\n        }\r\n        if (center)\r\n        {\r\n            this.moveCenter(save)\r\n        }\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * zoom viewport to specific value\r\n     * @param {number} scale value (e.g., 1 would be 100%, 0.25 would be 25%)\r\n     * @param {boolean} [center] maintain the same center of the screen after zoom\r\n     * @return {Viewport} this\r\n     */\r\n    setZoom(scale, center)\r\n    {\r\n        let save\r\n        if (center)\r\n        {\r\n            save = this.center\r\n        }\r\n        this.scale.set(scale)\r\n        const clampZoom = this.plugins.get('clamp-zoom')\r\n        if (clampZoom)\r\n        {\r\n            clampZoom.clamp()\r\n        }\r\n        if (center)\r\n        {\r\n            this.moveCenter(save)\r\n        }\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * zoom viewport by a certain percent (in both x and y direction)\r\n     * @param {number} percent change (e.g., 0.25 would increase a starting scale of 1.0 to 1.25)\r\n     * @param {boolean} [center] maintain the same center of the screen after zoom\r\n     * @return {Viewport} this\r\n     */\r\n    zoomPercent(percent, center)\r\n    {\r\n        return this.setZoom(this.scale.x + this.scale.x * percent, center)\r\n    }\r\n\r\n    /**\r\n     * zoom viewport by increasing/decreasing width by a certain number of pixels\r\n     * @param {number} change in pixels\r\n     * @param {boolean} [center] maintain the same center of the screen after zoom\r\n     * @return {Viewport} this\r\n     */\r\n    zoom(change, center)\r\n    {\r\n        this.fitWidth(change + this.worldScreenWidth, center)\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * changes scale of viewport and maintains center of viewport\r\n     * @type {number}\r\n     */\r\n    set scaled(scale)\r\n    {\r\n        this.setZoom(scale, true)\r\n    }\r\n    get scaled()\r\n    {\r\n        return this.scale.x\r\n    }\r\n\r\n    /**\r\n     * @param {SnapZoomOptions} options\r\n     */\r\n    snapZoom(options)\r\n    {\r\n        this.plugins.add('snap-zoom', new SnapZoom(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * is container out of world bounds\r\n     * @returns {OutOfBounds}\r\n     */\r\n    OOB()\r\n    {\r\n        return {\r\n            left: this.left < 0,\r\n            right: this.right > this.worldWidth,\r\n            top: this.top < 0,\r\n            bottom: this.bottom > this._worldHeight,\r\n            cornerPoint: new PIXI.Point(\r\n                this.worldWidth * this.scale.x - this.screenWidth,\r\n                this.worldHeight * this.scale.y - this.screenHeight\r\n            )\r\n        }\r\n    }\r\n\r\n    /**\r\n     * world coordinates of the right edge of the screen\r\n     * @type {number}\r\n     */\r\n    get right()\r\n    {\r\n        return -this.x / this.scale.x + this.worldScreenWidth\r\n    }\r\n    set right(value)\r\n    {\r\n        this.x = -value * this.scale.x + this.screenWidth\r\n        this.plugins.reset()\r\n    }\r\n\r\n    /**\r\n     * world coordinates of the left edge of the screen\r\n     * @type { number }\r\n     */\r\n    get left()\r\n    {\r\n        return -this.x / this.scale.x\r\n    }\r\n    set left(value)\r\n    {\r\n        this.x = -value * this.scale.x\r\n        this.plugins.reset()\r\n    }\r\n\r\n    /**\r\n     * world coordinates of the top edge of the screen\r\n     * @type {number}\r\n     */\r\n    get top()\r\n    {\r\n        return -this.y / this.scale.y\r\n    }\r\n    set top(value)\r\n    {\r\n        this.y = -value * this.scale.y\r\n        this.plugins.reset()\r\n    }\r\n\r\n    /**\r\n     * world coordinates of the bottom edge of the screen\r\n     * @type {number}\r\n     */\r\n    get bottom()\r\n    {\r\n        return -this.y / this.scale.y + this.worldScreenHeight\r\n    }\r\n    set bottom(value)\r\n    {\r\n        this.y = -value * this.scale.y + this.screenHeight\r\n        this.plugins.reset()\r\n    }\r\n\r\n    /**\r\n     * determines whether the viewport is dirty (i.e., needs to be renderered to the screen because of a change)\r\n     * @type {boolean}\r\n     */\r\n    get dirty()\r\n    {\r\n        return this._dirty\r\n    }\r\n    set dirty(value)\r\n    {\r\n        this._dirty = value\r\n    }\r\n\r\n    /**\r\n     * permanently changes the Viewport's hitArea\r\n     * NOTE: if not set then hitArea = PIXI.Rectangle(Viewport.left, Viewport.top, Viewport.worldScreenWidth, Viewport.worldScreenHeight)\r\n     * @returns {HitArea}\r\n     */\r\n    get forceHitArea()\r\n    {\r\n        return this._forceHitArea\r\n    }\r\n    set forceHitArea(value)\r\n    {\r\n        if (value)\r\n        {\r\n            this._forceHitArea = value\r\n            this.hitArea = value\r\n        }\r\n        else\r\n        {\r\n            this._forceHitArea = null\r\n            this.hitArea = new PIXI.Rectangle(0, 0, this.worldWidth, this.worldHeight)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * enable one-finger touch to drag\r\n     * NOTE: if you expect users to use right-click dragging, you should enable viewport.options.disableOnContextMenu to avoid the context menu popping up on each right-click drag\r\n     * @param {DragOptions} [options]\r\n     * @returns {Viewport} this\r\n     */\r\n    drag(options)\r\n    {\r\n        this.plugins.add('drag', new Drag(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * clamp to world boundaries or other provided boundaries\r\n     * NOTES:\r\n     *   clamp is disabled if called with no options; use { direction: 'all' } for all edge clamping\r\n     *   screenWidth, screenHeight, worldWidth, and worldHeight needs to be set for this to work properly\r\n     * @param {ClampOptions} [options]\r\n     * @returns {Viewport} this\r\n     */\r\n    clamp(options)\r\n    {\r\n        this.plugins.add('clamp', new Clamp(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * decelerate after a move\r\n     * NOTE: this fires 'moved' event during deceleration\r\n     * @param {DecelerateOptions} [options]\r\n     * @return {Viewport} this\r\n     */\r\n    decelerate(options)\r\n    {\r\n        this.plugins.add('decelerate', new Decelerate(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * bounce on borders\r\n     * NOTES:\r\n     *    screenWidth, screenHeight, worldWidth, and worldHeight needs to be set for this to work properly\r\n     *    fires 'moved', 'bounce-x-start', 'bounce-y-start', 'bounce-x-end', and 'bounce-y-end' events\r\n     * @param {object} [options]\r\n     * @param {string} [options.sides=all] all, horizontal, vertical, or combination of top, bottom, right, left (e.g., 'top-bottom-right')\r\n     * @param {number} [options.friction=0.5] friction to apply to decelerate if active\r\n     * @param {number} [options.time=150] time in ms to finish bounce\r\n     * @param {string|function} [options.ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)\r\n     * @param {string} [options.underflow=center] (top/bottom/center and left/right/center, or center) where to place world if too small for screen\r\n     * @return {Viewport} this\r\n     */\r\n    bounce(options)\r\n    {\r\n        this.plugins.add('bounce', new Bounce(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * enable pinch to zoom and two-finger touch to drag\r\n     * @param {PinchOptions} [options]\r\n     * @return {Viewport} this\r\n     */\r\n    pinch(options)\r\n    {\r\n        this.plugins.add('pinch', new Pinch(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * snap to a point\r\n     * @param {number} x\r\n     * @param {number} y\r\n     * @param {SnapOptions} [options]\r\n     * @return {Viewport} this\r\n     */\r\n    snap(x, y, options)\r\n    {\r\n        this.plugins.add('snap', new Snap(this, x, y, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * follow a target\r\n     * NOTES:\r\n     *    uses the (x, y) as the center to follow; for PIXI.Sprite to work properly, use sprite.anchor.set(0.5)\r\n     *    options.acceleration is not perfect as it doesn't know the velocity of the target\r\n     *    it adds acceleration to the start of movement and deceleration to the end of movement when the target is stopped\r\n     *    fires 'moved' event\r\n     * @param {PIXI.DisplayObject} target to follow\r\n     * @param {FollowOptions} [options]\r\n     * @returns {Viewport} this\r\n     */\r\n    follow(target, options)\r\n    {\r\n        this.plugins.add('follow', new Follow(this, target, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * zoom using mouse wheel\r\n     * @param {WheelOptions} [options]\r\n     * @return {Viewport} this\r\n     */\r\n    wheel(options)\r\n    {\r\n        this.plugins.add('wheel', new Wheel(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * enable clamping of zoom to constraints\r\n     * @description\r\n     * The minWidth/Height settings are how small the world can get (as it would appear on the screen)\r\n     * before clamping. The maxWidth/maxHeight is how larger the world can scale (as it would appear on\r\n     * the screen) before clamping.\r\n     *\r\n     * For example, if you have a world size of 1000 x 1000 and a screen size of 100 x 100, if you set\r\n     * minWidth/Height = 100 then the world will not be able to zoom smaller than the screen size (ie,\r\n     * zooming out so it appears smaller than the screen). Similarly, if you set maxWidth/Height = 100\r\n     * the world will not be able to zoom larger than the screen size (ie, zooming in so it appears\r\n     * larger than the screen).\r\n     * @param {ClampZoomOptions} [options]\r\n     * @return {Viewport} this\r\n     */\r\n    clampZoom(options)\r\n    {\r\n        this.plugins.add('clamp-zoom', new ClampZoom(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * Scroll viewport when mouse hovers near one of the edges or radius-distance from center of screen.\r\n     * NOTE: fires 'moved' event\r\n     * @param {MouseEdgesOptions} [options]\r\n     */\r\n    mouseEdges(options)\r\n    {\r\n        this.plugins.add('mouse-edges', new MouseEdges(this, options))\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * pause viewport (including animation updates such as decelerate)\r\n     * @type {boolean}\r\n     */\r\n    get pause()\r\n    {\r\n        return this._pause\r\n    }\r\n    set pause(value)\r\n    {\r\n        this._pause = value\r\n        this.lastViewport = null\r\n        this.moving = false\r\n        this.zooming = false\r\n        if (value)\r\n        {\r\n            this.input.pause()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * move the viewport so the bounding box is visible\r\n     * @param {number} x - left\r\n     * @param {number} y - top\r\n     * @param {number} width\r\n     * @param {number} height\r\n     * @param {boolean} [resizeToFit] resize the viewport so the box fits within the viewport\r\n     */\r\n    ensureVisible(x, y, width, height, resizeToFit)\r\n    {\r\n        if (resizeToFit && (width > this.worldScreenWidth || height > this.worldScreenHeight))\r\n        {\r\n            this.fit(true, width, height)\r\n            this.emit('zoomed', { viewport: this, type: 'ensureVisible' })\r\n        }\r\n        let moved = false\r\n        if (x < this.left)\r\n        {\r\n            this.left = x\r\n            moved = true\r\n        }\r\n        else if (x + width > this.right)\r\n        {\r\n            this.right = x + width\r\n            moved = true\r\n        }\r\n        if (y < this.top)\r\n        {\r\n            this.top = y\r\n            moved = true\r\n        }\r\n        else if (y + height > this.bottom)\r\n        {\r\n            this.bottom = y + height\r\n            moved = true\r\n        }\r\n        if (moved)\r\n        {\r\n            this.emit('moved', { viewport: this, type: 'ensureVisible' })\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * fires after a mouse or touch click\r\n * @event Viewport#clicked\r\n * @type {object}\r\n * @property {PIXI.Point} screen\r\n * @property {PIXI.Point} world\r\n * @property {Viewport} viewport\r\n */\r\n\r\n/**\r\n * fires when a drag starts\r\n * @event Viewport#drag-start\r\n * @type {object}\r\n * @property {PIXI.Point} screen\r\n * @property {PIXI.Point} world\r\n * @property {Viewport} viewport\r\n */\r\n\r\n/**\r\n * fires when a drag ends\r\n * @event Viewport#drag-end\r\n * @type {object}\r\n * @property {PIXI.Point} screen\r\n * @property {PIXI.Point} world\r\n * @property {Viewport} viewport\r\n */\r\n\r\n/**\r\n * fires when a pinch starts\r\n * @event Viewport#pinch-start\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a pinch end\r\n * @event Viewport#pinch-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a snap starts\r\n * @event Viewport#snap-start\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a snap ends\r\n * @event Viewport#snap-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a snap-zoom starts\r\n * @event Viewport#snap-zoom-start\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a snap-zoom ends\r\n * @event Viewport#snap-zoom-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a bounce starts in the x direction\r\n * @event Viewport#bounce-x-start\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a bounce ends in the x direction\r\n * @event Viewport#bounce-x-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a bounce starts in the y direction\r\n * @event Viewport#bounce-y-start\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a bounce ends in the y direction\r\n * @event Viewport#bounce-y-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when for a mouse wheel event\r\n * @event Viewport#wheel\r\n * @type {object}\r\n * @property {object} wheel\r\n * @property {number} wheel.dx\r\n * @property {number} wheel.dy\r\n * @property {number} wheel.dz\r\n * @property {Viewport} viewport\r\n */\r\n\r\n/**\r\n * fires when a wheel-scroll occurs\r\n * @event Viewport#wheel-scroll\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when a mouse-edge starts to scroll\r\n * @event Viewport#mouse-edge-start\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when the mouse-edge scrolling ends\r\n * @event Viewport#mouse-edge-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when viewport moves through UI interaction, deceleration, ensureVisible, or follow\r\n * @event Viewport#moved\r\n * @type {object}\r\n * @property {Viewport} viewport\r\n * @property {string} type (drag, snap, pinch, follow, bounce-x, bounce-y, clamp-x, clamp-y, decelerate, mouse-edges, wheel, ensureVisible)\r\n */\r\n\r\n/**\r\n * fires when viewport moves through UI interaction, deceleration, ensureVisible, or follow\r\n * @event Viewport#zoomed\r\n * @type {object}\r\n * @property {Viewport} viewport\r\n * @property {string} type (drag-zoom, pinch, wheel, clamp-zoom, ensureVisible)\r\n */\r\n\r\n/**\r\n * fires when viewport stops moving\r\n * @event Viewport#moved-end\r\n * @type {Viewport}\r\n */\r\n\r\n/**\r\n * fires when viewport stops zooming\r\n * @event Viewport#zoomed-end\r\n * @type {Viewport}\r\n */\r\n\r\n /**\r\n * fires at the end of an update frame\r\n * @event Viewport#frame-end\r\n * @type {Viewport}\r\n */\r\n\r\n/** @typedef HitArea {(PIXI.Rectangle | PIXI.Circle | PIXI.Ellipse | PIXI.Polygon | PIXI.RoundedRectangle)} */\r\n\r\n/**\r\n * @typedef {Object} OutOfBounds\r\n * @private\r\n * @property {boolean} left\r\n * @property {boolean} right\r\n * @property {boolean} top\r\n * @property {boolean} bottom\r\n * @property {PIXI.Point} cornerPoint\r\n */\r\n\r\n/**\r\n * @typedef {Object} LastViewport\r\n * @private\r\n * @property {number} x\r\n * @property {number} y\r\n * @property {number} scaleX\r\n * @property {number} scaleY\r\n */"],"names":["InputManager","[object Object]","viewport","this","touches","addListeners","interactive","forceHitArea","hitArea","PIXI.Rectangle","worldWidth","worldHeight","on","down","move","up","wheelFunction","e","handleWheel","options","divWheel","addEventListener","passive","passiveWheel","isMouseDown","removeEventListener","event","pause","worldVisible","data","pointerType","get","pointerId","push","id","last","count","global","clone","decelerate","plugins","bounce","isActive","clickedAvailable","stopPropagation","change","Math","abs","threshold","stop","distX","x","distY","y","checkThreshold","remove","emit","screen","world","toWorld","point","PIXI.Point","interaction","mapPositionToPoint","clientX","clientY","toLocal","getPointerPosition","left","right","top","bottom","wheel","preventDefault","touch","i","length","splice","PLUGIN_ORDER","PluginManager","list","name","plugin","index","current","indexOf","sort","elapsed","update","resize","reset","resume","result","Plugin","parent","paused","dragOptions","direction","pressDrag","wheelScroll","reverse","clampWheel","underflow","factor","mouseButtons","keyToPress","ignoreKeyToPressOnTouch","Drag","super","Object","assign","moved","xDirection","yDirection","keyIsPressed","parseUnderflow","handleKeyPresses","codes","includes","code","buttons","mouse","clamp","toLowerCase","underflowX","underflowY","isMouse","input","button","checkButtons","checkKeyPress","active","newPoint","type","pointer","deltaX","deltaY","screenWorldWidth","screenWidth","scale","screenWorldHeight","screenHeight","pinchOptions","noDrag","percent","center","Pinch","pointers","first","second","sqrt","pow","oldPoint","moveCenter","toGlobal","lastCenter","pinching","clampOptions","Clamp","scaleX","scaleY","noUnderflow","original","clampZoomOptions","minWidth","minHeight","maxWidth","maxHeight","minScale","maxScale","ClampZoom","width","worldScreenWidth","height","worldScreenHeight","fitWidth","fitHeight","set","decelerateOptions","friction","minSpeed","Decelerate","saved","time","performance","now","save","percentChangeX","percentChangeY","penner","factory","module","umd","linear","t","b","c","d","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","cos","PI","easeOutSine","sin","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","a","p","s","asin","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","call","ease","defaults","Penner","bounceOptions","sides","bounceBox","Bounce","toX","toY","end","start","delta","box","x1","y1","topLeft","bottomRight","oob","drag","pinch","calcUnderflowX","calcUnderflowY","snapOptions","interrupt","removeOnComplete","removeOnInterrupt","forceStart","Snap","snapStart","snapping","corner","startX","startY","finished","moveCorner","snapZoomOptions","removeOnInterrupts","noMove","SnapZoom","xScale","yScale","xIndependent","yIndependent","container","createSnapping","oldCenter","followOptions","speed","acceleration","radius","Follow","target","velocity","angle","atan2","distance","decelerationDistance","min","max","changeX","changeY","wheelOptions","smooth","Wheel","smoothing","smoothingCenter","smoothingCount","step","deltaMode","dx","dy","dz","deltaZ","mouseEdgesOptions","noDecelerate","allowButtons","MouseEdges","radiusSquared","horizontal","vertical","identifier","toScreen","round","decelerateHorizontal","decelerateVertical","activate","viewportOptions","window","innerWidth","innerHeight","noTicker","disableOnContextMenu","PIXI.Container","ticker","pixiNS","PIXI","parseInt","exec","PIXI.VERSION","shared","Ticker","_worldWidth","_worldHeight","document","body","oncontextmenu","tickerFunction","elapsedMS","add","destroy","lastViewport","moving","zooming","_hitAreaDefault","_dirty","value","arguments","isNaN","position","dirty","noClamp","clampZoom","setZoom","scaled","cornerPoint","_forceHitArea","_pause","resizeToFit","fit"],"mappings":"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"}